<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>游泳規劃器 CYBER</title>
<style>
/* ===== 基礎重置 ===== */
* { box-sizing: border-box; margin: 0; padding: 0; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }

:root {
  --primary: #00a2ff;
  --success: #4cd964;
  --warn: #ff3b30;
  --bg-dark: #0c0f18;
  --panel-bg: #121524;
  --input-bg: #1a1f34;
}

/* ===== 全局樣式 ===== */
html, body {
  font-family: "SF Pro Text","PingFang TC","Helvetica Neue",sans-serif;
  background: #0c0f18;
  height: 100dvh;
  overflow: hidden;
  color: #e0e0e0;
}

.app { display: flex; flex-direction: column; height: 100dvh; }

/* ===== Header & 靈動島避讓 ===== */
.fixed-header {
  flex-shrink: 0;
  padding-top: max(15px, env(safe-area-inset-top));
  background: #0c0f18;
  border-bottom: 1px solid #222;
}

.header-hud {
  display: flex; justify-content: space-between; align-items: flex-end;
  padding: 10px 15px 12px;
}

.time-overlay {
  position: relative;
  text-align: right;
  min-width: 130px;
  background: #121524;
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid #222;
}

.bg-number {
  position: absolute;
  right: 8px;
  bottom: 0;
  font-size: 36px;
  font-weight: 900;
  color: #1b1e2c;
  opacity: 0.5;
  transform: scaleX(1.3);
  pointer-events: none;
  z-index: 1;
}

.main-number {
  position: relative;
  z-index: 2;
  font-size: 22px;
  font-weight: 900;
  color: var(--success);
}

/* ===== 輸入區 ===== */
.input-section { padding: 10px 15px; display: flex; flex-direction: column; gap: 10px; }

.label-sm { font-size: 10px; color: #888; font-weight: 700; margin-bottom: 2px; }

.row { display: flex; gap: 8px; align-items: flex-end; }

.input-box {
  background: var(--input-bg);
  border: 1px solid #222;
  border-radius: 8px;
  padding: 5px;
  flex: 1;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.7);
  transition: 0.15s ease-out;
}

.input-box.active {
  border-color: var(--primary);
  box-shadow: 0 0 8px var(--primary), inset 0 0 5px rgba(0,162,255,0.3);
}

.val-group { display: flex; align-items: baseline; justify-content: center; }
.val-group input {
  width: 100%; background: transparent; border: none; color: #fff;
  font-size: 20px; font-weight: 800; text-align: center; outline: none;
}
.unit { font-size: 9px; color: #aaa; margin-left: 2px; font-weight: bold; }

/* ===== 加入項目按鈕 ===== */
.rest-and-add {
  display: flex; gap: 8px; align-items: center;
}
.btn-add {
  flex: 0.6;
  background: #00a2ff;
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: 900;
  font-size: 15px;
  padding: 8px 0;
  text-align: center;
  box-shadow: 0 3px 6px rgba(0,0,0,0.5);
}
.btn-add:active { transform: translateY(1px); }

/* ===== 列表區域 ===== */
.main-content {
  flex: 1;
  overflow-y: auto;
  padding: 10px 15px;
  -webkit-overflow-scrolling: touch;
}
.course-item {
  background: #121524;
  padding: 10px 12px;
  border-radius: 8px;
  margin-bottom: 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-left: 4px solid var(--primary);
}
.item-info b { font-size: 14px; color: #fff; }
.item-info p { font-size: 10px; color: #888; }
.item-time { font-size: 16px; font-weight: 900; color: #4cd964; }

/* ===== 底部固定鍵盤 ===== */
.fixed-footer { 
  flex-shrink: 0;
  background: #0c0f18;
  border-top: 1px solid #222;
  padding-bottom: max(10px, env(safe-area-inset-bottom));
}

.footer-ctrl {
  padding: 5px 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.btn-reset {
  background: #121524;
  color: var(--warn);
  border: 1px solid var(--warn);
  border-radius: 6px;
  font-size: 11px;
  font-weight: 800;
  padding: 5px 10px;
}

.numpad {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
  padding: 6px 15px;
}
.numpad button {
  background: #1a1f34;
  color: #fff;
  border: 1px solid #222;
  border-radius: 8px;
  font-size: 22px;
  font-weight: 700;
  padding: 12px 0;
}
.numpad button:active { background: #111425; }
.btn-util { color: #888 !important; font-size: 16px !important; }

.warn { color: var(--warn) !important; font-weight: 900; }

</style>
</head>
<body>

<div class="app">
  <header class="fixed-header">
    <div class="header-hud">
      <div>
        <span class="label-sm">總長度 (分)</span>
        <div class="input-box" id="box-classTime" style="width: 85px;">
           <div class="val-group"><input id="classTime" readonly placeholder="0"></div>
        </div>
      </div>
      <div class="time-overlay">
        <span class="label-sm">剩餘可用</span>
        <div id="bgTotal" class="bg-number">00</div>
        <div id="remainingText" class="main-number">0分00秒</div>
      </div>
    </div>

    <section class="input-section">
      <div class="row">
        <div style="flex: 1.1;">
          <span class="label-sm">單趟時間</span>
          <div style="display:flex; gap:6px;">
            <div class="input-box" id="box-lapMin"><div class="val-group"><input id="lapMin" readonly placeholder="0" data-next="lapSec"><span class="unit">分</span></div></div>
            <div class="input-box" id="box-lapSec"><div class="val-group"><input id="lapSec" readonly placeholder="0" data-next="lapsPerSet"><span class="unit">秒</span></div></div>
          </div>
        </div>
        <div style="flex: 1;">
          <span class="label-sm">訓練結構</span>
          <div style="display:flex; gap:6px;">
            <div class="input-box" id="box-lapsPerSet"><div class="val-group"><input id="lapsPerSet" readonly placeholder="0" data-next="sets"><span class="unit">趟</span></div></div>
            <div class="input-box" id="box-sets"><div class="val-group"><input id="sets" readonly placeholder="0" data-next="restMin"><span class="unit">組</span></div></div>
          </div>
        </div>
      </div>

      <div class="rest-and-add">
        <div style="flex:1; display:flex; gap:6px;">
          <div class="input-box" id="box-restMin"><div class="val-group"><input id="restMin" readonly placeholder="0" data-next="restSec"><span class="unit">分</span></div></div>
          <div class="input-box" id="box-restSec"><div class="val-group"><input id="restSec" readonly placeholder="0"><span class="unit">秒</span></div></div>
        </div>
        <button class="btn-add" onclick="addItem()">加入項目 (+)</button>
      </div>
    </section>
  </header>

  <main id="scrollArea" class="main-content">
    <div id="listContainer"></div>
  </main>

  <footer class="fixed-footer">
    <div class="footer-ctrl">
      <span style="font-size:9px; color:#888;">長按項目可刪除</span>
      <button class="btn-reset" onclick="clearAll()">重置資料</button>
    </div>
    <div class="numpad">
      <button onclick="num(7)">7</button><button onclick="num(8)">8</button><button onclick="num(9)">9</button>
      <button onclick="num(4)">4</button><button onclick="num(5)">5</button><button onclick="num(6)">6</button>
      <button onclick="num(1)">1</button><button onclick="num(2)">2</button><button onclick="num(3)">3</button>
      <button class="btn-util" onclick="clearInput()">AC</button>
      <button onclick="num(0)">0</button>
      <button class="btn-util" onclick="back()">⌫</button>
    </div>
  </footer>
</div>

<script>
let activeInput = document.getElementById("classTime");
let items = [];
let pressTimer = null;

const vibrate = (ms) => { if (navigator.vibrate) navigator.vibrate(ms); };

const formatTimeCH = s => {
  const isNeg = s < 0;
  const abs = Math.abs(s);
  return (isNeg ? "-" : "") + `${Math.floor(abs/60)}分${(abs%60).toString().padStart(2,'0')}秒`;
};

function updateFocusUI(el) {
  document.querySelectorAll('.input-box').forEach(b => b.classList.remove('active'));
  let parent = el.closest('.input-box');
  if(parent) parent.classList.add('active');
}

document.querySelectorAll("input").forEach(input => {
  input.addEventListener("click", function(e) {
    activeInput = this;
    updateFocusUI(this);
    e.stopPropagation();
  });
});

function num(n) {
  if(!activeInput) return;
  if(activeInput.value.length >= 3) return;
  activeInput.value += n;
  vibrate(10);
  render();
  if(activeInput.dataset.next && activeInput.value.length === 2){
    const next = document.getElementById(activeInput.dataset.next);
    if(next.value === ""){
      activeInput = next; updateFocusUI(next);
    }
  }
}

function back() { if(activeInput) { activeInput.value = activeInput.value.slice(0,-1); render(); } }
function clearInput() { if(activeInput) { activeInput.value = ''; render(); } }

function addItem() {
  const getVal = id => +document.getElementById(id).value || 0;
  const lm = getVal("lapMin"), ls = getVal("lapSec"), lps = getVal("lapsPerSet"), st = getVal("sets"), rm = getVal("restMin"), rs = getVal("restSec");
  if(lps<=0 || st<=0) { vibrate([40,40]); return; }
  const total=((lm*60+ls)*lps*st)+((rm*60+rs)*(st>1?st-1:0));
  items.push({id:Date.now(),desc:`${lps}趟 x ${st}組`,seconds:total});
  ["lapMin","lapSec","lapsPerSet","sets","restMin","restSec"].forEach(id=>document.getElementById(id).value="");
  activeInput=document.getElementById("lapMin"); updateFocusUI(activeInput);
  render();
  setTimeout(()=>document.getElementById("scrollArea").scrollTo({top:document.getElementById("scrollArea").scrollHeight,behavior:'smooth'}),100);
}

function render(){
  const classVal = +document.getElementById("classTime").value || 0;
  document.getElementById("bgTotal").innerText=classVal.toString().padStart(2,'0');
  const used=items.reduce((sum,it)=>sum+it.seconds,0);
  const remaining=(classVal*60)-used;
  const rText=document.getElementById("remainingText");
  rText.innerText=formatTimeCH(remaining);
  rText.classList.toggle("warn",remaining<0);

  const container=document.getElementById("listContainer");
  container.innerHTML="";
  items.forEach((item,index)=>{
    const div=document.createElement("div");
    div.className="course-item";
    div.innerHTML=`<div class="item-info"><b>項目 #${index+1}</b><p>${item.desc}</p></div><div class="item-time">${formatTimeCH(item.seconds)}</div>`;
    div.ontouchstart=()=>pressTimer=setTimeout(()=>{vibrate(50); if(confirm("刪除此項目？")){items.splice(index,1);render();}},600);
    div.ontouchend=()=>clearTimeout(pressTimer);
    container.appendChild(div);
  });
}

function clearAll(){ 
  if(confirm("確定清空所有數據？")){
    items=[]; document.getElementById("classTime").value=""; render(); vibrate(60);
  }
}

updateFocusUI(activeInput);
render();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<title>æ¸¸æ³³èª²ç¨‹æ™‚é–“è¦åŠƒå™¨</title>

<style>
* { box-sizing: border-box; }

html, body {
    margin: 0;
    padding: 0;
    background: #eaf6ff;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
    touch-action: manipulation;
}

/* ===== App æ¶æ§‹ ===== */
.app {
    display: flex;
    flex-direction: column;
    height: 100vh;
    padding:
        env(safe-area-inset-top)
        env(safe-area-inset-right)
        env(safe-area-inset-bottom)
        env(safe-area-inset-left);
}

.main {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
    padding-bottom: 200px;
}

.container {
    max-width: 480px;
    margin: auto;
    background: #fff;
    padding: 16px;
    border-radius: 16px;
    box-shadow: 0 6px 16px rgba(0,0,0,.15);
}

h1 {
    text-align: center;
    font-size: 20px;
    color: #0b5394;
    margin-bottom: 12px;
}

.section { margin-top: 12px; }

.label {
    font-weight: 600;
    margin-bottom: 6px;
}

.grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
}

input {
    width: 100%;
    padding: 12px;
    font-size: 18px;
    border-radius: 12px;
    border: 1px solid #bbb;
    text-align: center;
    caret-color: transparent;
}

button.action {
    width: 100%;
    margin-top: 14px;
    padding: 14px;
    font-size: 17px;
    background: #1abc9c;
    color: white;
    border: none;
    border-radius: 12px;
}

.summary {
    margin-top: 14px;
    padding: 12px;
    border-radius: 12px;
}
.ok { background: #e8f8f5; }
.over { background: #fdecea; color: #c0392b; }

/* ===== èª²ç¨‹æ¸…å–® ===== */
.list {
    margin-top: 12px;
    font-size: 15px;
}

.item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    margin-bottom: 6px;
    border-radius: 10px;
    background: #f4f9ff;
    border: 1px dashed #aac;
    cursor: grab;
}

.item.dragging {
    opacity: 0.4;
}

.delete {
    color: #c0392b;
    font-weight: bold;
    margin-left: 10px;
    cursor: pointer;
}

/* ===== ä¹å®®æ ¼éµç›¤ ===== */
.numpad {
    position: sticky;
    bottom: 0;
    background: #f8f9fa;
    padding: 8px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    border-top: 1px solid #ccc;
}

.numpad button {
    font-size: 18px;
    padding: 12px 0;
    border-radius: 10px;
    background: #fff;
    border: 1px solid #ccc;
}
</style>
</head>

<body>

<div class="app">

<div class="main">
<div class="container">
<h1>ğŸŠ èª²ç¨‹æ™‚é–“è¦åŠƒå™¨</h1>

<div class="section">
    <div class="label">èª²å ‚ç¸½æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</div>
    <input readonly data-num id="classTime">
</div>

<div class="section">
    <div class="label">æ¯è¶Ÿæ™‚é–“</div>
    <div class="grid-2">
        <input readonly data-num id="lapMin" placeholder="åˆ†">
        <input readonly data-num id="lapSec" placeholder="ç§’">
    </div>
</div>

<div class="section grid-2">
    <input readonly data-num id="lapsPerSet" placeholder="æ¯çµ„å¹¾è¶Ÿ">
    <input readonly data-num id="sets" placeholder="çµ„æ•¸">
</div>

<div class="section">
    <div class="label">æ¯çµ„ä¼‘æ¯</div>
    <div class="grid-2">
        <input readonly data-num id="restMin" placeholder="åˆ†">
        <input readonly data-num id="restSec" placeholder="ç§’">
    </div>
</div>

<button class="action" onclick="addItem()">â• åŠ å…¥èª²ç¨‹é …ç›®</button>

<div id="summary" class="summary ok">â³ å°šæœªè¨ˆç®—</div>
<div id="list" class="list"></div>

</div>
</div>

<!-- ä¹å®®æ ¼éµç›¤ -->
<div class="numpad">
    <button onclick="num(7)">7</button>
    <button onclick="num(8)">8</button>
    <button onclick="num(9)">9</button>
    <button onclick="num(4)">4</button>
    <button onclick="num(5)">5</button>
    <button onclick="num(6)">6</button>
    <button onclick="num(1)">1</button>
    <button onclick="num(2)">2</button>
    <button onclick="num(3)">3</button>
    <button onclick="back()">âŒ«</button>
    <button onclick="num(0)">0</button>
    <button onclick="clearInput()">OK</button>
</div>

</div>

<script>
let activeInput = null;
let remainingSeconds = null;
let items = [];
let dragIndex = null;

const f = s => `${Math.floor(s/60)} åˆ† ${s%60} ç§’`;

document.querySelectorAll("[data-num]").forEach(i => {
    i.addEventListener("pointerdown", () => activeInput = i);
});

function num(n){ if(activeInput) activeInput.value+=n; }
function back(){ if(activeInput) activeInput.value=activeInput.value.slice(0,-1); }
function clearInput(){ if(activeInput) activeInput.blur(); }

/* ===== æ ¸å¿ƒé‚è¼¯ ===== */
function addItem(){
    if(remainingSeconds===null)
        remainingSeconds=(classTime.value||0)*60;

    const lap=(+lapMin.value||0)*60+(+lapSec.value||0);
    const swim=lap*(+lapsPerSet.value||0)*(+sets.value||0);
    const rest=((+restMin.value||0)*60+(+restSec.value||0))*Math.max((+sets.value||0)-1,0);
    const total=swim+rest;

    remainingSeconds-=total;
    items.push(total);
    render();
}

function render(){
    list.innerHTML="";
    items.forEach((sec,i)=>{
        const d=document.createElement("div");
        d.className="item";
        d.draggable=true;
        d.innerHTML=`â˜° ç¬¬ ${i+1} é …ï¼š${f(sec)} <span class="delete" onclick="del(${i})">âœ•</span>`;

        d.addEventListener("dragstart",()=>{ dragIndex=i; d.classList.add("dragging"); });
        d.addEventListener("dragend",()=>d.classList.remove("dragging"));
        d.addEventListener("dragover",e=>e.preventDefault());
        d.addEventListener("drop",()=>swap(i));

        list.appendChild(d);
    });

    summary.className="summary "+(remainingSeconds>=0?"ok":"over");
    summary.innerHTML=remainingSeconds>=0
        ?`â³ å‰©é¤˜æ™‚é–“ï¼š${f(remainingSeconds)}`
        :`âš ï¸ è¶…éæ™‚é–“ï¼š${f(-remainingSeconds)}`;
}

function swap(i){
    if(dragIndex===null||dragIndex===i) return;
    [items[dragIndex],items[i]]=[items[i],items[dragIndex]];
    dragIndex=null;
    render();
}

function del(i){
    remainingSeconds+=items[i];
    items.splice(i,1);
    render();
}
</script>

</body>
</html>

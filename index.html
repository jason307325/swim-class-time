<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>æ¸¸æ³³è¦åŠƒå¤§å¸« Pro v4</title>
<style>
:root {
  --bg-dark: #0d1117;
  --neon-blue: #00a2ff;
  --neon-green: #4cd964;
  --neon-red: #ff3b30;
  --panel-grad: linear-gradient(180deg, #1e242e 0%, #141820 100%);
}

* { 
  box-sizing: border-box; 
  margin: 0; padding: 0; 
  touch-action: manipulation; 
  -webkit-user-select: none;
  user-select: none;
}

body {
  font-family: -apple-system, "PingFang TC", "Microsoft JhengHei", sans-serif;
  background-color: var(--bg-dark);
  color: #fff;
  height: 100dvh; 
  display: flex;
  flex-direction: column;
  overflow: hidden; 
}

/* 1. HUD å€åŸŸé‡æ§‹ - æ°´å¹³ä¸‰æ¬„ */
.hud-container {
  padding: calc(env(safe-area-inset-top, 10px) + 10px) 15px 15px;
  display: flex; 
  justify-content: space-between; 
  align-items: center;
  background: #05070a;
  border-bottom: 1px solid #1a2028;
  flex-shrink: 0;
  gap: 10px;
}

.hud-item { flex: 1; display: flex; flex-direction: column; align-items: center; }
.hud-item.left { align-items: flex-start; }
.hud-item.right { align-items: flex-end; }

.label-sm { font-size: 10px; color: #888; font-weight: 600; margin-bottom: 4px; white-space: nowrap; }

.glass-box {
  background: #090c10; border-radius: 8px; border: 2px solid #1a2028;
  display: flex; align-items: center; justify-content: center; transition: 0.15s;
  overflow: hidden;
}

.glass-box.active-blue { border-color: var(--neon-blue); box-shadow: 0 0 8px rgba(0,162,255,0.3); }
.glass-box.active-green { border-color: var(--neon-green); box-shadow: 0 0 8px rgba(76,217,100,0.3); }

.glass-box input {
  width: 100%; background: transparent; border: none; color: #fff;
  font-size: 18px; font-weight: 800; text-align: center; outline: none; pointer-events: none;
}

/* å‰©é¤˜æ™‚é–“ç½®ä¸­æ”¾å¤§ */
#remText { font-size: 26px; font-weight: 900; color: var(--neon-green); line-height: 1; }
/* ç¸½è·é›¢æ”¾å¤§ */
#totalDist { font-size: 18px; color: var(--neon-blue); font-weight: 900; }

/* é¢æ¿å„ªåŒ– */
.panel {
  margin: 10px 15px 5px; padding: 12px; border-radius: 12px;
  background: var(--panel-grad); border: 1px solid #2a323d; flex-shrink: 0;
}
.row { display: flex; gap: 6px; margin-bottom: 8px; }

/* æ–‡å­—è¼¸å…¥æ¡† */
.text-input-box {
  width: 100%; height: 36px; background: rgba(0,0,0,0.3); border: 1px solid #333;
  border-radius: 6px; color: #fff; padding: 0 10px; font-size: 14px; margin-bottom: 8px;
  -webkit-user-select: text; user-select: text; /* å…è¨±è¼¸å…¥ */
}

.unit { font-size: 9px; color: #666; font-weight: bold; margin-left: 1px; padding-right: 3px; }

.btn-add {
  flex: 1; height: 42px; 
  background: linear-gradient(180deg, #007aff 0%, #004a99 100%);
  border: 1px solid var(--neon-blue); border-radius: 8px; color: white; 
  font-weight: 800; font-size: 15px;
}

.btn-share {
  background: #282c34; border: 1px solid #444; border-radius: 8px;
  color: #ddd; padding: 0 15px; font-size: 13px; font-weight: 600;
}

/* æ¸…å–®å€åŸŸ */
.list-area {
  flex: 1; overflow-y: auto; margin: 5px 15px;
  -webkit-overflow-scrolling: touch;
}

.course-card {
  background: rgba(255,255,255,0.03); border-radius: 8px; padding: 12px;
  margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;
  border: 1px solid #222; position: relative;
}
.course-card b { font-size: 14px; color: var(--neon-blue); }
.course-card p { font-size: 12px; color: #bbb; margin-top: 4px; line-height: 1.4; }
.card-dist { font-size: 13px; color: var(--neon-green); font-weight: bold; }

/* éµç›¤ */
.fixed-footer {
  background: #0a0d12; border-top: 1px solid #222;
  padding: 5px 10px calc(env(safe-area-inset-bottom, 15px) + 5px);
}
.footer-ctrl { display: flex; justify-content: space-between; align-items: center; padding: 0 5px 8px; }
.hint-text { font-size: 10px; color: #555; }
.btn-reset { background: #333; border: none; color: #aaa; padding: 4px 10px; border-radius: 4px; font-size: 11px; }

.numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
.num-btn {
  height: 44px; background: #1c222d; border-radius: 6px; font-size: 20px; color: white;
  display: flex; align-items: center; justify-content: center; font-weight: 600;
}
.num-btn:active { background: #3d4654; }

.warn { color: var(--neon-red) !important; text-shadow: 0 0 10px rgba(255,0,0,0.5); }
</style>
</head>
<body>

  <div class="hud-container">
    <div class="hud-item left">
      <span class="label-sm">ç¸½é ç®—/åˆ†</span>
      <div class="glass-box" id="box-classTime" onclick="setFocus('classTime')" style="width: 80px; height: 38px;">
        <input id="classTime" readonly placeholder="0">
      </div>
    </div>
    
    <div class="hud-item">
      <span class="label-sm">å‰©é¤˜æ™‚é–“</span>
      <div id="remText">0åˆ†00ç§’</div>
    </div>

    <div class="hud-item right">
      <span class="label-sm">ç¸½ç´¯ç©é•·åº¦</span>
      <div id="totalDist">0 m</div>
    </div>
  </div>

  <div class="panel">
    <input type="text" id="courseNote" class="text-input-box" placeholder="é»æ“Šè¼¸å…¥èª²ç¨‹å…§å®¹ (ä¾‹: ä¸»èª²è¨“ç·´ Warm up)..." onfocus="currentFocus='none'">
    
    <div class="row">
      <div style="flex:1"><span class="label-sm">å–®è¶Ÿ/åˆ†</span><div class="glass-box" id="box-lapMin" onclick="setFocus('lapMin')" style="height:36px;"><input id="lapMin" readonly placeholder="0"></div></div>
      <div style="flex:1"><span class="label-sm">å–®è¶Ÿ/ç§’</span><div class="glass-box" id="box-lapSec" onclick="setFocus('lapSec')" style="height:36px;"><input id="lapSec" readonly placeholder="0"></div></div>
      <div style="flex:1.2"><span class="label-sm">å–®è¶Ÿ/è·é›¢</span><div class="glass-box" id="box-dist" onclick="setFocus('dist')" style="height:36px;"><input id="dist" readonly placeholder="0"><span class="unit">m</span></div></div>
      <div style="flex:0.8"><span class="label-sm">å–®è¶Ÿ/è¶Ÿæ•¸</span><div class="glass-box" id="box-laps" onclick="setFocus('laps')" style="height:36px;"><input id="laps" readonly placeholder="0"></div></div>
    </div>
    
    <div class="row" style="align-items: flex-end;">
      <div style="flex: 1.5;">
        <span class="label-sm">çµ„æ•¸èˆ‡çµ„é–“ä¼‘æ¯ (åˆ†/ç§’)</span>
        <div class="row" style="margin-bottom:0">
          <div class="glass-box" id="box-sets" onclick="setFocus('sets')" style="flex:0.8; height:36px;"><input id="sets" readonly placeholder="0"><span class="unit">çµ„</span></div>
          <div class="glass-box" id="box-restMin" onclick="setFocus('restMin')" style="flex:1; height:36px;"><input id="restMin" readonly placeholder="0"><span class="unit">åˆ†</span></div>
          <div class="glass-box" id="box-restSec" onclick="setFocus('restSec')" style="flex:1; height:36px;"><input id="restSec" readonly placeholder="0"><span class="unit">ç§’</span></div>
        </div>
      </div>
      <button class="btn-add" onclick="addItem()">åŠ å…¥é …ç›®</button>
    </div>
  </div>

  <div class="list-area" id="listArea"></div>

  <footer class="fixed-footer">
    <div class="footer-ctrl">
      <button class="btn-share" onclick="copyToClipboard()">ğŸ“‹ è¤‡è£½æ–‡å­—æª” (Line)</button>
      <button class="btn-reset" onclick="resetAll()">å…¨éƒ¨æ¸…ç©º</button>
    </div>
    <div class="numpad">
      <div class="num-btn" onclick="press(7)">7</div><div class="num-btn" onclick="press(8)">8</div><div class="num-btn" onclick="press(9)">9</div>
      <div class="num-btn" onclick="press(4)">4</div><div class="num-btn" onclick="press(5)">5</div><div class="num-btn" onclick="press(6)">6</div>
      <div class="num-btn" onclick="press(1)">1</div><div class="num-btn" onclick="press(2)">2</div><div class="num-btn" onclick="press(3)">3</div>
      <div class="num-btn" style="color:#666;" onclick="cls()">AC</div><div class="num-btn" onclick="press(0)">0</div><div class="num-btn" style="color:var(--neon-red);" onclick="del()">âŒ«</div>
    </div>
  </footer>

<script>
let currentFocus = 'classTime';
let items = JSON.parse(localStorage.getItem('swim_v4_items')) || [];

function save() {
  localStorage.setItem('swim_v4_items', JSON.stringify(items));
  localStorage.setItem('swim_v4_total_time', document.getElementById('classTime').value);
}

function setFocus(id) {
  currentFocus = id;
  document.querySelectorAll('.glass-box').forEach(b => b.classList.remove('active-blue', 'active-green'));
  const box = document.getElementById('box-' + id);
  
  // ç¶ è‰²ç¾¤çµ„ï¼šè·Ÿè·é›¢èˆ‡æ¬¡æ•¸ç›¸é—œ
  if (['laps', 'dist', 'sets'].includes(id)) {
    ['box-laps', 'box-dist', 'box-sets'].forEach(bId => document.getElementById(bId).classList.add('active-green'));
  } else if (box) {
    box.classList.add('active-blue');
  }
}

function press(n) {
  if (currentFocus === 'none') return;
  const input = document.getElementById(currentFocus);
  if (!input) return;
  if (input.value.length < 4) {
    input.value = (input.value === "0") ? n : input.value + n;
    renderHUD();
  }
}

function del() { 
  if (currentFocus === 'none') return;
  document.getElementById(currentFocus).value = document.getElementById(currentFocus).value.slice(0, -1); 
  renderHUD(); 
}

function cls() { 
  if (currentFocus === 'none') return;
  document.getElementById(currentFocus).value = ""; 
  renderHUD(); 
}

function renderHUD() {
  const totalMin = parseInt(document.getElementById('classTime').value) || 0;
  const usedSec = items.reduce((sum, i) => sum + i.seconds, 0);
  const totalD = items.reduce((sum, i) => sum + i.dist, 0);
  const remSec = (totalMin * 60) - usedSec;
  
  const absSec = Math.abs(remSec);
  const min = Math.floor(absSec / 60);
  const sec = (absSec % 60).toString().padStart(2, '0');
  
  document.getElementById('remText').innerText = `${remSec < 0 ? "-" : ""}${min}åˆ†${sec}ç§’`;
  document.getElementById('remText').classList.toggle('warn', remSec < 0);
  document.getElementById('totalDist').innerText = `${totalD} m`;
  save();
}

function addItem() {
  const g = id => parseInt(document.getElementById(id).value) || 0;
  const note = document.getElementById('courseNote').value.trim() || "æ¸¸æ³³è¨“ç·´";
  const lm = g('lapMin'), ls = g('lapSec'), dist = g('dist'), laps = g('laps'), sets = g('sets'), rm = g('restMin'), rs = g('restSec');
  
  if (dist === 0 || sets === 0 || laps === 0) {
    alert("è«‹è¼¸å…¥è·é›¢ã€è¶Ÿæ•¸èˆ‡çµ„æ•¸");
    return;
  }
  
  // è¨ˆç®—é‚è¼¯ï¼š(å–®è¶Ÿæ™‚é–“ * è¶Ÿæ•¸ + ä¼‘æ¯) * çµ„æ•¸
  // ä½†é€šå¸¸ä¼‘æ¯æ˜¯ã€Œçµ„é–“ã€ä¼‘æ¯ï¼Œæ‰€ä»¥æ˜¯ï¼š(å–®è¶Ÿæ™‚é–“ * è¶Ÿæ•¸) * çµ„æ•¸ + ä¼‘æ¯ * (çµ„æ•¸-1)
  const oneSetMoveSec = (lm * 60 + ls) * laps;
  const totalMoveSec = oneSetMoveSec * sets;
  const totalRestSec = (rm * 60 + rs) * (sets > 1 ? sets - 1 : 0);
  
  const totalItemDist = dist * laps * sets;
  const totalItemTime = totalMoveSec + totalRestSec;
  
  items.push({ 
    seconds: totalItemTime, 
    dist: totalItemDist,
    title: note,
    desc: `${dist}m Ã— ${laps}è¶Ÿ Ã— ${sets}çµ„ (çµ„é–“ä¼‘ ${rm}'${rs}")` 
  });
  
  // æ¸…ç©ºè¼¸å…¥ (ä¸åŒ…å«ç¸½æ™‚é–“èˆ‡å‚™è¨»)
  ['lapMin','lapSec','dist','laps','sets','restMin','restSec'].forEach(id => document.getElementById(id).value = "");
  document.getElementById('courseNote').value = "";
  
  updateList(); 
  renderHUD();
  setFocus('dist');
}

function updateList() {
  const container = document.getElementById('listArea');
  container.innerHTML = items.map((item, index) => `
    <div class="course-card" ontouchstart="startPress(${index})" ontouchend="endPress()" onmousedown="startPress(${index})" onmouseup="endPress()">
      <div>
        <b>#${index+1} ${item.title}</b>
        <p>${item.desc}</p>
      </div>
      <div style="text-align:right">
        <div class="card-dist">${item.dist} m</div>
        <div style="font-weight:800; font-size: 14px; margin-top:2px; color:#fff;">
          ${Math.floor(item.seconds/60)}'${(item.seconds%60).toString().padStart(2,'0')}"
        </div>
      </div>
    </div>
  `).join('');
  container.scrollTop = container.scrollHeight;
}

// è¼¸å‡ºæ–‡å­—æª”åŠŸèƒ½
function copyToClipboard() {
  if (items.length === 0) {
    alert("ç›®å‰æ²’æœ‰è¨“ç·´é …ç›®å¯åŒ¯å‡º");
    return;
  }
  
  const totalD = items.reduce((sum, i) => sum + i.dist, 0);
  const totalS = items.reduce((sum, i) => sum + i.seconds, 0);
  
  let txt = `ğŸŠâ€â™‚ï¸ ã€ä»Šæ—¥æ¸¸æ³³è¨“ç·´èª²è¡¨ã€‘\n`;
  txt += `ç¸½é ç®—æ™‚é–“ï¼š${document.getElementById('classTime').value} åˆ†é˜\n`;
  txt += `ç¸½ç´¯ç©è·é›¢ï¼š${totalD} m\n`;
  txt += `é è¨ˆç¸½è€—æ™‚ï¼š${Math.floor(totalS/60)}åˆ†${totalS%60}ç§’\n`;
  txt += `----------------------\n`;
  
  items.forEach((item, idx) => {
    txt += `${idx+1}. ${item.title}\n   å…§å®¹ï¼š${item.desc}\n   å°è¨ˆï¼š${item.dist}m (${Math.floor(item.seconds/60)}'${item.seconds%60}")\n`;
  });
  
  txt += `----------------------\nåŒ¯å‡ºæ™‚é–“ï¼š${new Date().toLocaleString()}`;

  // è¤‡è£½åˆ°å‰ªè²¼ç°¿
  const el = document.createElement('textarea');
  el.value = txt;
  document.body.appendChild(el);
  el.select();
  document.execCommand('copy');
  document.body.removeChild(el);
  
  alert("èª²è¡¨å·²è¤‡è£½ï¼ç¾åœ¨å¯ä»¥åˆ° Line è²¼ä¸Šäº†ã€‚");
}

let pressTimer;
function startPress(i) { pressTimer = setTimeout(() => { if(confirm("ç¢ºå®šåˆªé™¤æ­¤è¨“ç·´é …ç›®å—ï¼Ÿ")) { items.splice(i, 1); updateList(); renderHUD(); } }, 650); }
function endPress() { clearTimeout(pressTimer); }

function resetAll() {
  if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¨“ç·´æ•¸æ“šå—ï¼Ÿ")) {
    items = []; 
    document.getElementById('classTime').value = "";
    document.getElementById('courseNote').value = "";
    ['lapMin','lapSec','dist','laps','sets','restMin','restSec'].forEach(id => document.getElementById(id).value = "");
    updateList(); renderHUD();
  }
}

window.onload = () => {
  const savedTime = localStorage.getItem('swim_v4_total_time');
  if(savedTime) document.getElementById('classTime').value = savedTime;
  updateList(); 
  renderHUD(); 
  setFocus('classTime');
};
</script>
</body>
</html>

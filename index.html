<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>游泳規劃器 CYBER</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }

:root {
  --primary:#00a2ff; 
  --success:#4cd964; 
  --warn:#ff3b30;
  --bg-dark:#0a0b1a; /* 深藍色背景 */
  --panel-bg:#121529;
  --input-bg:#1a1f36;
  --glow-blue:rgba(0,162,255,0.4); 
  --glow-green:rgba(76,217,100,0.4);
}

html,body{
  font-family:"SF Pro Text","PingFang TC",sans-serif; 
  background: var(--bg-dark); 
  height:100dvh; 
  overflow:hidden; 
  color:#e0e0e0;
}

.app{
  display:flex;flex-direction:column;height:100dvh;
  background: var(--bg-dark);
}

/* ===== Header & 靈動島避讓 ===== */
.fixed-header{
  flex-shrink:0; 
  background:var(--panel-bg); 
  border-bottom:1px solid #222; 
  padding-top:max(15px, env(safe-area-inset-top)); 
  box-shadow: 0 4px 20px rgba(0,0,0,0.5);
}

.header-hud{padding:10px 15px 12px; display:flex; justify-content:space-between; align-items:flex-end;}

.time-overlay{
  position:relative; text-align:right; min-width:130px; 
  padding:8px 12px; border-radius:10px; border:1px solid #333; 
}

.bg-number{position:absolute; right:10px; bottom:0; font-size:48px; font-weight:900; color:#121529; opacity:0.8; transform:scaleX(1.4); transform-origin:right; z-index:1; pointer-events:none;}
.main-number{position:relative; z-index:2; font-size:24px; font-weight:900; color:var(--success); text-shadow:0 0 10px var(--glow-green); transform:scaleX(1.05); transform-origin:right; animation: neonPulse 1.2s infinite alternate;}
@keyframes neonPulse{
  0%,100%{text-shadow:0 0 6px var(--primary),0 0 12px var(--success);}
  50%{text-shadow:0 0 10px var(--primary),0 0 18px var(--success);}
}

/* ===== 輸入區 ===== */
.input-section{padding:10px 15px; display:flex; flex-direction:column; gap:8px;}
.label-sm{font-size:10px;color:#888;font-weight:800;margin-bottom:2px;display:block; letter-spacing:0.5px;}
.row{display:flex; gap:8px; align-items:flex-end;}

/* 輸入框質感調整 */
.input-box{
  background:var(--input-bg); 
  border:1px solid #333; 
  border-radius:10px; 
  padding:5px; flex:1; 
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.7), inset 0 -2px 4px rgba(255,255,255,0.05);
  transition:0.2s;
}
.input-box.active{
  border:1px solid var(--primary); 
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.7), inset 0 -2px 4px rgba(255,255,255,0.1), 0 0 8px var(--glow-blue);
}

.val-group{display:flex;align-items:baseline; justify-content:center;}
.val-group input{width:100%; background:transparent; border:none; color:#fff; font-size:20px; font-weight:800; text-align:center; outline:none;}
.unit{font-size:9px; color:#aaa; font-weight:bold; margin-left:2px;}

/* 按鈕質感 */
.btn-add{
  background: linear-gradient(145deg,#0a1f4a,#002366);
  color:#fff; 
  border-radius:10px; 
  font-size:14px; font-weight:900; 
  border:1px solid #0055aa;
  box-shadow: 0 4px 8px rgba(0,0,0,0.6), inset 0 1px 2px rgba(255,255,255,0.05);
  transition:0.2s;
}
.btn-add:active{
  transform:translateY(1px);
  box-shadow: inset 0 2px 5px rgba(0,0,0,0.7);
}

/* 主區域 */
.main-content{flex:1; overflow-y:auto; padding:10px 15px; -webkit-overflow-scrolling:touch;}
.course-item{
  background:linear-gradient(145deg,#1a1f36,#121529);
  padding:12px; border-radius:10px; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center;
  border:1px solid #222;
}
.item-info b{font-size:13px; color:#fff;}
.item-info p{font-size:10px; color:#aaa;}
.item-time{font-size:16px; font-weight:800; color:#fff;}

/* 底部鍵盤 */
.fixed-footer{flex-shrink:0; background:#121529; border-top:1px solid #222; padding-bottom:max(10px, env(safe-area-inset-bottom);}
.footer-ctrl{padding:6px 15px; display:flex; justify-content:space-between; align-items:center;}
.btn-reset{background:#1a1f36; color:var(--warn); border:1px solid var(--warn); padding:3px 10px; border-radius:5px; font-size:10px; font-weight:bold;}
.numpad{display:grid; grid-template-columns:repeat(3,1fr); gap:8px; padding:5px 15px;}
.numpad button{
  border:1px solid #222; 
  background: linear-gradient(145deg,#0d1a3a,#001f66);
  font-size:24px; font-weight:600; color:white; border-radius:10px; padding:10px 0; 
  box-shadow: 2px 2px 4px #000, inset 0 -2px 2px rgba(255,255,255,0.05);
  transition:0.2s;
}
.numpad button:active{
  background:#001f66;
  box-shadow: inset 2px 2px 6px #000;
}
.btn-util{color:#888 !important; font-size:14px !important;}
.warn{color:var(--warn) !important; text-shadow:0 0 6px rgba(255,59,48,0.5); animation: blink 1s infinite;}
@keyframes blink{50%{opacity:0.5;}}
</style>
</head>
<body>
<div class="app">
  <header class="fixed-header">
    <div class="header-hud">
      <div>
        <span class="label-sm">總長度 (分)</span>
        <div class="input-box" id="box-classTime" style="width:85px;">
          <div class="val-group"><input id="classTime" readonly placeholder="0"></div>
        </div>
      </div>
      <div class="time-overlay">
        <span class="label-sm">剩餘可用</span>
        <div id="bgTotal" class="bg-number">00</div>
        <div id="remainingText" class="main-number">0分00秒</div>
      </div>
    </div>

    <section class="input-section">
      <div class="row">
        <div style="flex:1;">
          <span class="label-sm">單趟時間</span>
          <div style="display:flex; gap:6px;">
            <div class="input-box" id="box-lapMin"><div class="val-group"><input id="lapMin" readonly placeholder="0" data-next="lapSec"><span class="unit">分</span></div></div>
            <div class="input-box" id="box-lapSec"><div class="val-group"><input id="lapSec" readonly placeholder="0" data-next="lapsPerSet"><span class="unit">秒</span></div></div>
          </div>
        </div>
      </div>
      <div class="row">
        <div style="flex:1;">
          <span class="label-sm">訓練結構</span>
          <div style="display:flex; gap:6px;">
            <div class="input-box" id="box-lapsPerSet"><div class="val-group"><input id="lapsPerSet" readonly placeholder="0" data-next="sets"><span class="unit">趟</span></div></div>
            <div class="input-box" id="box-sets"><div class="val-group"><input id="sets" readonly placeholder="0" data-next="restMin"><span class="unit">組</span></div></div>
          </div>
        </div>
      </div>
      <div class="row">
        <div style="flex:1;">
          <span class="label-sm">組間休息</span>
          <div style="display:flex; gap:6px;">
            <div class="input-box" id="box-restMin"><div class="val-group"><input id="restMin" readonly placeholder="0" data-next="restSec"><span class="unit">分</span></div></div>
            <div class="input-box" id="box-restSec"><div class="val-group"><input id="restSec" readonly placeholder="0" data-next="lapMin"><span class="unit">秒</span></div></div>
          </div>
        </div>
        <button class="btn-add" onclick="addItem()">加入項目 (+)</button>
      </div>
    </section>
  </header>

  <main id="scrollArea" class="main-content"><div id="listContainer"></div></main>

  <footer class="fixed-footer">
    <div class="footer-ctrl">
      <span style="font-size:9px; color:#444; font-weight:bold;">LONG PRESS TO DELETE</span>
      <button class="btn-reset" onclick="clearAll()">重置資料</button>
    </div>
    <div class="numpad">
      <button onclick="num(7)">7</button><button onclick="num(8)">8</button><button onclick="num(9)">9</button>
      <button onclick="num(4)">4</button><button onclick="num(5)">5</button><button onclick="num(6)">6</button>
      <button onclick="num(1)">1</button><button onclick="num(2)">2</button><button onclick="num(3)">3</button>
      <button class="btn-util" onclick="clearInput()">AC</button>
      <button onclick="num(0)">0</button>
      <button class="btn-util" style="color:var(--warn) !important;" onclick="back()">⌫</button>
    </div>
  </footer>
</div>

<script>
/* 保留原有計算邏輯與鍵盤功能，無修改 */
let activeInput=document.getElementById("classTime"); let items=[]; let pressTimer=null;
const vibrate=ms=>{if(navigator.vibrate)navigator.vibrate(ms);}
const formatTimeCH=s=>{const isNeg=s<0; const abs=Math.abs(s); return (isNeg?"-":"")+`${Math.floor(abs/60)}分${(abs%60).toString().padStart(2,'0')}秒`;}
function updateFocusUI(el){document.querySelectorAll('.input-box').forEach(b=>b.classList.remove('active')); let parent=el.closest('.input-box'); if(parent) parent.classList.add('active');}
document.querySelectorAll("input").forEach(input=>{input.addEventListener("click",function(e){activeInput=this; updateFocusUI(this); e.stopPropagation();});});
function num(n){if(!activeInput)return;if(activeInput.id!=="classTime"&&activeInput.value.length>=2)return;if(activeInput.id==="classTime"&&activeInput.value.length>=3)return;activeInput.value+=n; vibrate(10); render(); if(activeInput.value.length===2 && activeInput.dataset.next){const next=document.getElementById(activeInput.dataset.next); if(next && next.value===""){activeInput=next; updateFocusUI(next);}}}
function back(){if(activeInput && activeInput.value.length>0){activeInput.value=activeInput.value.slice(0,-1); render();}}
function clearInput(){if(activeInput){activeInput.value=""; render();}}
function addItem(){const getVal=id=>+document.getElementById(id).value||0; const lm=getVal("lapMin"), ls=getVal("lapSec"), lps=getVal("lapsPerSet"), st=getVal("sets"), rm=getVal("restMin"), rs=getVal("restSec"); if(st<=0||lps<=0){vibrate([40,40]); return;} const total=((lm*60+ls)*lps*st)+((rm*60+rs)*(st>1?st-1:0)); items.push({id:Date.now(), desc:`${lps}趟 x ${st}組`, seconds:total}); vibrate(20); ["lapMin","lapSec","lapsPerSet","sets","restMin","restSec"].forEach(id=>document.getElementById(id).value=""); activeInput=document.getElementById("lapMin"); updateFocusUI(activeInput); render(); const sa=document.getElementById("scrollArea"); setTimeout(()=>sa.scrollTo({top:sa.scrollHeight, behavior:'smooth'}),100);}
function render(){const classVal=+document.getElementById("classTime").value||0; document.getElementById("bgTotal").innerText=classVal.toString().padStart(2,'0'); const used=items.reduce((sum,item)=>sum+item.seconds,0); const remaining=(classVal*60)-used; const rText=document.getElementById("remainingText"); rText.innerText=formatTimeCH(remaining); rText.classList.toggle("warn",remaining<0); const container=document.getElementById("listContainer"); container.innerHTML=""; items.forEach((item,index)=>{const div=document.createElement("div"); div.className="course-item"; div.innerHTML=`<div class="item-info"><b>項目 #${index+1}</b><p>${item.desc}</p></div><div class="item-time">${formatTimeCH(item.seconds)}</div>`; let startY; div.ontouchstart=e=>{startY=e.touches[0].clientY; pressTimer=setTimeout(()=>{vibrate(50); if(confirm("刪除此項目？")){items.splice(index,1); render();}},600)}; div.ontouchmove=e=>{if(Math.abs(e.touches[0].clientY-startY)>10) clearTimeout(pressTimer);}; div.ontouchend=()=>clearTimeout(pressTimer); container.appendChild(div);});}
function clearAll(){if(confirm("確定清空所有數據？")){items=[]; document.getElementById("classTime").value=""; render(); vibrate(60);}}
updateFocusUI(activeInput); render();
</script>
</body>
</html>

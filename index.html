<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<title>æ¸¸æ³³èª²ç¨‹æ™‚é–“è¦åŠƒå™¨ - æ–°éµç›¤ç‰ˆ</title>
<style>
* { box-sizing:border-box; margin:0; padding:0; }

html,body {
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:#eaf6ff;
  height:100%;
  touch-action: manipulation;
}

.app { display:flex; flex-direction:column; height:100vh; padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); }
.main { flex:1; overflow-y:auto; padding:16px; padding-bottom:180px; }

h1 { text-align:center; font-size:22px; color:#0b5394; margin-bottom:16px; }

.container { max-width:480px; margin:auto; }

.section { margin-bottom:14px; }
.label { font-weight:600; margin-bottom:6px; display:block; }

.input-card { display:grid; grid-template-columns: repeat(2,1fr); gap:10px; margin-bottom:8px; }
input { width:100%; padding:12px; font-size:18px; border-radius:12px; border:1px solid #bbb; text-align:center; caret-color:initial; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.08); }

button.action { width:100%; margin-top:12px; padding:14px; font-size:17px; border:none; border-radius:12px; background:linear-gradient(145deg,#1abc9c,#16a085); color:#fff; box-shadow:0 4px 8px rgba(0,0,0,.2); transition:0.1s; }
button.action:active { transform:scale(0.97); box-shadow:0 2px 4px rgba(0,0,0,.2); }

.summary { padding:12px; border-radius:12px; font-weight:500; margin-bottom:12px; text-align:center; }
.ok { background:#e8f8f5; }
.over { background:#fdecea; color:#c0392b; }

.list { margin-bottom:10px; }
.item { display:flex; justify-content:space-between; align-items:center; padding:12px; margin-bottom:8px; border-radius:12px; background:#f4f9ff; border:1px dashed #aac; cursor:grab; transition:0.15s; }
.item.dragging { opacity:0.5; transform:scale(1.02); }
.delete { color:#c0392b; font-weight:bold; cursor:pointer; }

/* ===== è™›æ“¬éµç›¤ ===== */
.numpad {
  position:sticky; bottom:0;
  background:linear-gradient(145deg,#e0f0ff,#cce6ff);
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:6px;
  border-top-left-radius:20px;
  border-top-right-radius:20px;
  box-shadow:0 -4px 12px rgba(0,0,0,.15);
  z-index:10;
  height:35vh; /* éµç›¤é«˜åº¦æ§åˆ¶ */
  padding:6px;
}

.numpad button {
  font-size:24px;
  width:100%;
  aspect-ratio:1/1; /* æ–¹å½¢ */
  border-radius:12px;
  border:1px solid #aac;
  background:linear-gradient(145deg,#fff,#ddeeff);
  box-shadow:0 2px 4px rgba(0,0,0,.15);
  transition:0.1s;
}
.numpad button:active { transform:scale(0.95); box-shadow:inset 0 2px 4px rgba(0,0,0,.2); }
</style>
</head>
<body>
<div class="app">
<div class="main">
<div class="container">
<h1>ğŸŠ æ¸¸æ³³èª²ç¨‹æ™‚é–“è¦åŠƒå™¨</h1>

<div class="section">
    <span class="label">èª²å ‚ç¸½æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</span>
    <input id="classTime">
</div>

<div class="section">
    <span class="label">æ¯è¶Ÿæ™‚é–“</span>
    <div class="input-card">
        <input id="lapMin" placeholder="åˆ†">
        <input id="lapSec" placeholder="ç§’">
    </div>
</div>

<div class="section input-card">
    <input id="lapsPerSet" placeholder="æ¯çµ„å¹¾è¶Ÿ">
    <input id="sets" placeholder="çµ„æ•¸">
</div>

<div class="section">
    <span class="label">æ¯çµ„ä¼‘æ¯</span>
    <div class="input-card">
        <input id="restMin" placeholder="åˆ†">
        <input id="restSec" placeholder="ç§’">
    </div>
</div>

<button class="action" onclick="addItem()">â• åŠ å…¥èª²ç¨‹é …ç›®</button>
<button class="action" onclick="clearAll()">ğŸ—‘ ä¸€éµå…¨éƒ¨åˆªé™¤</button>

<div id="summary" class="summary ok">â³ å°šæœªè¨ˆç®—</div>
<div id="list" class="list"></div>
</div>
</div>

<div class="numpad">
  <button onclick="num(7)">7</button>
  <button onclick="num(8)">8</button>
  <button onclick="num(9)">9</button>
  <button onclick="num(4)">4</button>
  <button onclick="num(5)">5</button>
  <button onclick="num(6)">6</button>
  <button onclick="num(1)">1</button>
  <button onclick="num(2)">2</button>
  <button onclick="num(3)">3</button>
  <button onclick="clearInput()">AC</button>
  <button onclick="num(0)">0</button>
  <button onclick="back()">âŒ«</button>
</div>
</div>

<script>
let activeInput = null;
let remainingSeconds = null;
let items = [];
let dragIndex = null;

const f = s => `${Math.floor(s/60)} åˆ† ${s%60} ç§’`;

// é»æ“Šè¼¸å…¥æ ¼æ¿€æ´»
document.querySelectorAll("input").forEach(i=>{
  i.addEventListener("focus",()=>activeInput=i);
  i.addEventListener("click",()=>activeInput=i);
});

// è™›æ“¬éµç›¤
function num(n){ if(activeInput) activeInput.value+=n; }
function back(){ if(activeInput) activeInput.value=activeInput.value.slice(0,-1); }
function clearInput(){ if(activeInput) activeInput.value=''; activeInput.blur(); }

// æ ¸å¿ƒè¨ˆç®—
function addItem(){
    if(remainingSeconds===null) remainingSeconds=(+classTime.value||0)*60;
    const lap=(+lapMin.value||0)*60+(+lapSec.value||0);
    const swim=lap*(+lapsPerSet.value||0)*(+sets.value||0);
    const rest=((+restMin.value||0)*60+(+restSec.value||0))*Math.max((+sets.value||0)-1,0);
    const total=swim+rest;
    remainingSeconds-=total;
    items.push(total);
    render();
}

function render(){
    list.innerHTML="";
    items.forEach((sec,i)=>{
        const d=document.createElement("div");
        d.className="item";
        d.draggable=true;
        d.innerHTML=`â˜° ç¬¬ ${i+1} é …ï¼š${f(sec)} <span class="delete" onclick="del(${i})">âœ•</span>`;
        d.addEventListener("dragstart",()=>{ dragIndex=i; d.classList.add("dragging"); });
        d.addEventListener("dragend",()=>d.classList.remove("dragging"));
        d.addEventListener("dragover",e=>e.preventDefault());
        d.addEventListener("drop",()=>swap(i));
        list.appendChild(d);
    });
    summary.className="summary "+(remainingSeconds>=0?"ok":"over");
    summary.innerHTML=remainingSeconds>=0 ? `â³ å‰©é¤˜æ™‚é–“ï¼š${f(remainingSeconds)}` : `âš ï¸ è¶…éæ™‚é–“ï¼š${f(-remainingSeconds)}`;
}

function swap(i){ if(dragIndex===null||dragIndex===i) return; [items[dragIndex],items[i]]=[items[i],items[dragIndex]]; dragIndex=null; render(); }
function del(i){ remainingSeconds+=items[i]; items.splice(i,1); render(); }
function clearAll(){ items=[]; remainingSeconds=(+classTime.value||0)*60; render(); }
</script>
</body>
</html>

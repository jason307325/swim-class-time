<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>游泳規劃器 ULTIMATE</title>
<style>
/* ===== 基礎重置與核心變數 ===== */
* { box-sizing: border-box; margin: 0; padding: 0; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
:root {
  --primary: #00a2ff;
  --success: #4cd964;
  --warn: #ff3b30;
  --bg-dark: #0a0b1a;
  --panel-bg: #101426;
  --input-bg: #14172b;
  --metal-shadow: rgba(0, 170, 255, 0.35);
}
html, body {
  font-family: "SF Pro Text","PingFang TC","Helvetica Neue",sans-serif;
  background-color: var(--bg-dark);
  height: 100dvh;
  overflow: hidden;
  color: #e0e0e0;
}
.app { display:flex; flex-direction:column; height:100dvh; }

/* ===== Header: 總長度 & 剩餘時間 ===== */
.fixed-header {
  flex-shrink:0;
  background: #0b0e1d;
  padding-top: max(15px, env(safe-area-inset-top));
  padding-bottom: 10px;
  border-bottom: 1px solid #222;
}
.header-hud {
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  padding:0 15px;
}
.time-section {
  display:flex;
  gap:15px;
  align-items:center;
  width:100%;
}
.time-box {
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:10px;
  border:1px solid #222;
  border-radius:8px;
  background:#121533;
  position:relative;
}
.time-box + .time-box::before {
  content:"";
  position:absolute;
  top:10%;
  left:-8px;
  height:80%;
  width:2px;
  background:#333;
}
.time-label { font-size:12px; color:#888; font-weight:600; margin-bottom:4px; }
.time-number { font-size:22px; font-weight:900; color:var(--success); }

/* ===== 輸入區: 單趟時間 / 訓練結構 / 休息時間 ===== */
.input-section {
  padding:10px 15px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.input-row {
  display:flex;
  gap:10px;
}
.input-col {
  flex:1;
  display:flex;
  flex-direction:column;
  gap:4px;
}
.label-sm { font-size:10px; color:#888; font-weight:600; }
.input-box {
  background:var(--input-bg);
  border:2px solid #222;
  border-radius:6px;
  padding:6px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition:0.2s;
}
.input-box.active {
  border-color: var(--primary);
  box-shadow: 0 0 10px var(--metal-shadow);
}
.val-group { display:flex; align-items:center; justify-content:center; gap:3px; }
.val-group input {
  width:100%;
  background:transparent;
  border:none;
  color:#fff;
  font-size:18px;
  font-weight:800;
  text-align:center;
  outline:none;
}
.unit { font-size:9px; color:#555; font-weight:bold; }

/* ===== 加入項目按鈕與休息時間同列 ===== */
.rest-add-row {
  display:flex;
  gap:10px;
  align-items:flex-end;
}
.btn-add {
  flex:0.9;
  background: linear-gradient(145deg,#007aff,#005bb5);
  border:1px solid #00a2ff;
  border-radius:6px;
  font-size:14px;
  font-weight:900;
  color:white;
  padding:10px 0;
  text-align:center;
}
.btn-add:active { transform:translateY(1px); }

/* ===== 課程清單區域 ===== */
.main-content {
  flex:1;
  overflow-y:auto;
  padding:10px 15px;
  background: linear-gradient(to bottom, #0b0e1d 0%, #080a14 100%);
  -webkit-overflow-scrolling: touch;
}
.course-item {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px;
  border-radius:8px;
  margin-bottom:8px;
  border-left:4px solid var(--primary);
  background:#10122a;
  box-shadow: inset 0 -2px 4px rgba(0,0,0,0.4);
}
.item-info b { font-size:13px; color:#fff; }
.item-info p { font-size:10px; color:#777; }
.item-time { font-size:15px; font-weight:800; color:#fff; }

/* ===== 底部固定虛擬鍵盤 ===== */
.fixed-footer {
  flex-shrink:0;
  background:#0b0e1d;
  border-top:1px solid #222;
  padding-bottom: max(10px, env(safe-area-inset-bottom));
}
.footer-ctrl { display:flex; justify-content:space-between; align-items:center; padding:5px 15px; }
.btn-reset { background:#111; color:var(--warn); border:1px solid var(--warn); border-radius:5px; font-size:10px; font-weight:bold; padding:4px 8px; }

.numpad {
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:6px;
  padding:6px 15px;
}
.numpad button {
  border:none;
  background: linear-gradient(145deg,#1b1e32,#10122a);
  color:white;
  font-size:22px;
  font-weight:700;
  border-radius:8px;
  padding:10px 0;
}
.numpad button:active {
  background:#080a14;
  box-shadow: inset 2px 2px 6px #000;
}
.btn-util { color:#666 !important; font-size:14px !important; }

.warn { color: var(--warn) !important; text-shadow:0 0 5px rgba(255,59,48,0.5); }
</style>
</head>
<body>
<div class="app">

<header class="fixed-header">
  <div class="time-section">
    <div class="time-box">
      <span class="time-label">總長度 (分)</span>
      <span class="time-number" id="bgTotal">0</span>
    </div>
    <div class="time-box">
      <span class="time-label">剩餘時間</span>
      <span class="time-number" id="remainingText">0分00秒</span>
    </div>
  </div>

  <section class="input-section">
    <div class="input-row">
      <div class="input-col">
        <span class="label-sm">單趟時間</span>
        <div class="input-row">
          <div class="input-box" id="box-lapMin"><div class="val-group"><input id="lapMin" readonly data-next="lapSec"><span class="unit">分</span></div></div>
          <div class="input-box" id="box-lapSec"><div class="val-group"><input id="lapSec" readonly data-next="lapsPerSet"><span class="unit">秒</span></div></div>
        </div>
      </div>
      <div class="input-col">
        <span class="label-sm">訓練結構</span>
        <div class="input-row">
          <div class="input-box" id="box-lapsPerSet"><div class="val-group"><input id="lapsPerSet" readonly data-next="sets"><span class="unit">趟</span></div></div>
          <div class="input-box" id="box-sets"><div class="val-group"><input id="sets" readonly data-next="restMin"><span class="unit">組</span></div></div>
        </div>
      </div>
    </div>

    <div class="rest-add-row">
      <div style="flex:1;">
        <span class="label-sm">組間休息</span>
        <div class="input-row">
          <div class="input-box" id="box-restMin"><div class="val-group"><input id="restMin" readonly data-next="restSec"><span class="unit">分</span></div></div>
          <div class="input-box" id="box-restSec"><div class="val-group"><input id="restSec" readonly><span class="unit">秒</span></div></div>
        </div>
      </div>
      <button class="btn-add" onclick="addItem()">加入項目 (+)</button>
    </div>
  </section>
</header>

<main class="main-content" id="scrollArea">
  <div id="listContainer"></div>
</main>

<footer class="fixed-footer">
  <div class="footer-ctrl">
    <span style="font-size:9px; color:#444; font-weight:bold;">長按刪除項目</span>
    <button class="btn-reset" onclick="clearAll()">重置資料</button>
  </div>
  <div class="numpad">
    <button onclick="num(7)">7</button><button onclick="num(8)">8</button><button onclick="num(9)">9</button>
    <button onclick="num(4)">4</button><button onclick="num(5)">5</button><button onclick="num(6)">6</button>
    <button onclick="num(1)">1</button><button onclick="num(2)">2</button><button onclick="num(3)">3</button>
    <button class="btn-util" onclick="clearInput()">AC</button>
    <button onclick="num(0)">0</button>
    <button class="btn-util" onclick="back()">⌫</button>
  </div>
</footer>

<script>
let activeInput=document.getElementById("lapMin");
let items=[];let pressTimer=null;
const vibrate=ms=>{if(navigator.vibrate)navigator.vibrate(ms);};
const formatTimeCH=s=>{const isNeg=s<0;const abs=Math.abs(s);return(isNeg?"-":"")+`${Math.floor(abs/60)}分${(abs%60).toString().padStart(2,'0')}秒`;};
function updateFocusUI(el){document.querySelectorAll('.input-box').forEach(b=>b.classList.remove('active'));let parent=el.closest('.input-box');if(parent)parent.classList.add('active');}
document.querySelectorAll("input").forEach(input=>{input.addEventListener("click",function(e){activeInput=this;updateFocusUI(this);e.preventDefault();e.stopPropagation();});});
function num(n){if(!activeInput)return;if(activeInput.value.length>=3)return;activeInput.value+=n;vibrate(10);render();if(activeInput.value.length===2&&activeInput.dataset.next){let next=document.getElementById(activeInput.dataset.next);if(next&&!next.value){activeInput=next;updateFocusUI(next);}}}
function back(){if(activeInput&&activeInput.value.length>0){activeInput.value=activeInput.value.slice(0,-1);render();}}
function clearInput(){if(activeInput){activeInput.value='';render();}}
function addItem(){const getVal=id=>+document.getElementById(id).value||0;const lm=getVal("lapMin"),ls=getVal("lapSec"),lps=getVal("lapsPerSet"),st=getVal("sets"),rm=getVal("restMin"),rs=getVal("restSec");if(st<=0||lps<=0){vibrate([40,40]);return;}const total=((lm*60+ls)*lps*st)+((rm*60+rs)*(st>1?st-1:0));items.push({id:Date.now(),desc:`${lps}趟 x ${st}組`,seconds:total});vibrate(20);["lapMin","lapSec","lapsPerSet","sets","restMin","restSec"].forEach(id=>document.getElementById(id).value="");activeInput=document.getElementById("lapMin");updateFocusUI(activeInput);render();document.getElementById("scrollArea").scrollTo({top:document.getElementById("scrollArea").scrollHeight,behavior:"smooth"});}
function render(){const classVal=+document.getElementById("bgTotal").innerText||0;const used=items.reduce((sum,item)=>sum+item.seconds,0);const remaining=(classVal*60)-used;document.getElementById("remainingText").innerText=formatTimeCH(remaining);document.getElementById("remainingText").classList.toggle("warn",remaining<0);const container=document.getElementById("listContainer");container.innerHTML="";items.forEach((item,index)=>{const div=document.createElement("div");div.className="course-item";div.innerHTML=`<div class="item-info"><b>項目 #${index+1}</b><p>${item.desc}</p></div><div class="item-time">${formatTimeCH(item.seconds)}</div>`;div.ontouchstart=()=>{pressTimer=setTimeout(()=>{vibrate(50);if(confirm("刪除此項目？")){items.splice(index,1);render();}},600);};div.ontouchend=()=>clearTimeout(pressTimer);container.appendChild(div);});}
function clearAll(){if(confirm("確定清空所有數據？")){items=[];document.getElementById("bgTotal").innerText="0";render();vibrate(60);}}
updateFocusUI(activeInput);
render();
</script>
</body>
</html>

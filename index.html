<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>æ¸¸æ³³è¦åŠƒå¤§å¸« Pro 2026</title>
<style>
:root {
  --bg-dark: #05070a;
  --panel-bg: #161b22;
  --neon-blue: #00d2ff;
  --neon-green: #39ff14;
  --neon-red: #ff3131;
  --text-main: #e6edf3;
}

* { box-sizing: border-box; margin: 0; padding: 0; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background-color: var(--bg-dark); color: var(--text-main);
  height: 100dvh; display: flex; flex-direction: column; overflow: hidden;
}

/* é ‚éƒ¨ HUD å„ªåŒ– - 2026 ç¾ä»£æ„Ÿæ¨£å¼ */
.hud-v3 {
  padding: calc(env(safe-area-inset-top) + 15px) 20px 20px;
  display: grid; grid-template-columns: 1fr 1.8fr 1fr; align-items: center;
  background: linear-gradient(to bottom, #0d1117, transparent);
}
.hud-center { text-align: center; }
.label-xs { font-size: 11px; color: #8b949e; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 4px; display: block; }
.main-rem-time { font-size: 38px; font-weight: 900; font-variant-numeric: tabular-nums; line-height: 1; transition: 0.3s; }
.big-dist { font-size: 22px; font-weight: 800; color: var(--neon-blue); }
.budget-box { border-bottom: 2px solid #30363d; padding: 2px 0; font-size: 20px; font-weight: bold; width: 60px; text-align: center; }

/* è¼¸å…¥å€å¡Š */
.container { flex: 1; overflow-y: auto; padding: 0 15px; }
.panel { 
    background: var(--panel-bg); border-radius: 16px; padding: 15px; 
    border: 1px solid #30363d; margin-bottom: 15px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}

.name-input {
  width: 100%; background: #0d1117; border: 1.5px solid #30363d; border-radius: 10px;
  color: #fff; padding: 12px; font-size: 16px; margin-bottom: 12px; outline: none;
}
.name-input:focus { border-color: var(--neon-blue); }

.row { display: flex; gap: 10px; margin-bottom: 12px; }
.input-group { flex: 1; display: flex; flex-direction: column; }
.glass-box {
  background: #0d1117; border-radius: 10px; border: 2px solid #30363d;
  height: 48px; display: flex; align-items: center; justify-content: center;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}
.glass-box.active { border-color: var(--neon-blue); background: #121d2f; transform: scale(1.02); }
.glass-box input {
  width: 100%; background: transparent; border: none; color: #fff;
  font-size: 18px; font-weight: 700; text-align: center; outline: none; pointer-events: none;
}
.unit-label { font-size: 10px; color: #6e7681; margin-left: -15px; padding-right: 5px; }

/* åˆ—è¡¨èˆ‡æŒ‰éˆ• */
.action-row { display: flex; gap: 10px; margin-bottom: 20px; }
.btn {
  flex: 1; height: 50px; border-radius: 12px; border: none; font-weight: 800; font-size: 15px;
  display: flex; align-items: center; justify-content: center; gap: 8px; transition: transform 0.1s;
}
.btn:active { transform: scale(0.95); }
.btn-primary { background: var(--neon-blue); color: #000; }
.btn-secondary { background: #238636; color: #fff; }

.course-card {
  background: #161b22; border-radius: 12px; padding: 15px; margin-bottom: 10px;
  border-left: 5px solid var(--neon-blue); display: flex; justify-content: space-between;
}

/* éµç›¤ */
.numpad { 
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; 
    padding: 15px 20px calc(env(safe-area-inset-bottom) + 10px);
    background: #0d1117; border-top: 1px solid #30363d;
}
.num-btn { 
    height: 55px; background: #21262d; border-radius: 12px; 
    display: flex; align-items: center; justify-content: center; 
    font-size: 22px; font-weight: 600; color: #c9d1d9;
}
.num-btn:active { background: #30363d; color: var(--neon-blue); }

.warn { color: var(--neon-red); text-shadow: 0 0 15px rgba(255,49,49,0.4); }
</style>
</head>
<body>

  <div class="hud-v3">
    <div class="hud-side">
      <span class="label-xs">é ç®—/åˆ†</span>
      <div class="budget-box" id="box-classTime" onclick="setFocus('classTime')">
        <input id="classTime" readonly value="60">
      </div>
    </div>
    <div class="hud-center">
      <span class="label-xs">å‰©é¤˜å¯ç”¨æ™‚é–“</span>
      <div class="main-rem-time" id="remText">60:00</div>
    </div>
    <div class="hud-side" style="text-align: right;">
      <span class="label-xs">ç¸½ç´¯è¨ˆè·é›¢</span>
      <div class="big-dist" id="totalDist">0m</div>
    </div>
  </div>

  <div class="container">
    <div class="panel">
      <input type="text" id="courseName" class="name-input" placeholder="ğŸ’¡ è¼¸å…¥èª²ç¨‹åç¨± (ä¸­è‹±æ–‡çš†å¯)">
      
      <div class="row">
        <div class="input-group"><span class="label-xs">å–®è¶Ÿ/åˆ†</span><div class="glass-box" id="box-lapMin" onclick="setFocus('lapMin')"><input id="lapMin" readonly placeholder="0"></div></div>
        <div class="input-group"><span class="label-xs">å–®è¶Ÿ/ç§’</span><div class="glass-box" id="box-lapSec" onclick="setFocus('lapSec')"><input id="lapSec" readonly placeholder="0"></div></div>
        <div class="input-group" style="flex:1.2"><span class="label-xs">å–®è¶Ÿ/è·é›¢</span><div class="glass-box" id="box-dist" onclick="setFocus('dist')"><input id="dist" readonly placeholder="0"><span class="unit-label">m</span></div></div>
      </div>
      
      <div class="row">
        <div class="input-group"><span class="label-xs">è¶Ÿæ•¸</span><div class="glass-box" id="box-laps" onclick="setFocus('laps')"><input id="laps" readonly placeholder="1"></div></div>
        <div class="input-group"><span class="label-xs">çµ„æ•¸</span><div class="glass-box" id="box-sets" onclick="setFocus('sets')"><input id="sets" readonly placeholder="1"></div></div>
        <div class="input-group" style="flex:1.2"><span class="label-xs">çµ„é–“ä¼‘æ¯/ç§’</span><div class="glass-box" id="box-restSec" onclick="setFocus('restSec')"><input id="restSec" readonly placeholder="0"><span class="unit-label">s</span></div></div>
      </div>

      <div class="action-row">
        <button class="btn btn-primary" onclick="addItem()">â• æ–°å¢é …ç›®</button>
        <button class="btn btn-secondary" onclick="exportToText()">ğŸ”— è¤‡è£½ LINE</button>
      </div>
    </div>

    <div id="listArea"></div>
  </div>

  <div class="numpad">
    <div class="num-btn" onclick="press(7)">7</div><div class="num-btn" onclick="press(8)">8</div><div class="num-btn" onclick="press(9)">9</div>
    <div class="num-btn" onclick="press(4)">4</div><div class="num-btn" onclick="press(5)">5</div><div class="num-btn" onclick="press(6)">6</div>
    <div class="num-btn" onclick="press(1)">1</div><div class="num-btn" onclick="press(2)">2</div><div class="num-btn" onclick="press(3)">3</div>
    <div class="num-btn" style="color:#8b949e" onclick="cls()">AC</div><div class="num-btn" onclick="press(0)">0</div><div class="num-btn" style="color:var(--neon-red)" onclick="del()">âŒ«</div>
  </div>

<script>
// å…§éƒ¨æ¸¬è©¦èˆ‡å„ªåŒ–é‚è¼¯
let currentFocus = 'lapMin';
let items = JSON.parse(localStorage.getItem('swim_v5_items')) || [];

// 1. è‡ªå‹•è·³è½‰é †åº
const focusOrder = ['classTime', 'lapMin', 'lapSec', 'dist', 'laps', 'sets', 'restSec'];

function setFocus(id) {
  currentFocus = id;
  document.querySelectorAll('.glass-box, .budget-box').forEach(b => b.classList.remove('active'));
  const target = document.getElementById('box-' + id);
  if(target) target.classList.add('active');
}

function press(n) {
  const input = document.getElementById(currentFocus);
  // é™åˆ¶é•·åº¦
  if (input.value.length >= 4) return;
  
  input.value = (input.value === "0") ? n : input.value + n;
  
  // UX å„ªåŒ–ï¼šè¼¸å…¥å®Œç§’æ•¸è‡ªå‹•è·³åˆ°è·é›¢ï¼Œè¼¸å…¥å®Œåˆ†è‡ªå‹•è·³ç§’
  if ((currentFocus === 'lapMin' || currentFocus === 'lapSec' || currentFocus === 'classTime') && input.value.length >= 2) {
      autoNextFocus();
  }
  renderHUD();
}

function autoNextFocus() {
    const idx = focusOrder.indexOf(currentFocus);
    if(idx < focusOrder.length - 1) setFocus(focusOrder[idx+1]);
}

function del() { 
    document.getElementById(currentFocus).value = document.getElementById(currentFocus).value.slice(0, -1); 
    renderHUD(); 
}

function cls() { 
    document.getElementById(currentFocus).value = ""; 
    renderHUD(); 
}

function addItem() {
  const name = document.getElementById('courseName').value.trim() || "æœªå‘½åè¨“ç·´";
  const lm = parseInt(document.getElementById('lapMin').value) || 0;
  const ls = parseInt(document.getElementById('lapSec').value) || 0;
  const dist = parseInt(document.getElementById('dist').value) || 0;
  const laps = parseInt(document.getElementById('laps').value) || 1;
  const sets = parseInt(document.getElementById('sets').value) || 1;
  const rs = parseInt(document.getElementById('restSec').value) || 0;

  if (dist <= 0) { alert("è«‹è¼¸å…¥å–®è¶Ÿè·é›¢"); return; }

  // é‚è¼¯æ¸¬è©¦ï¼šè¨ˆç®—ç¸½æ™‚é–“ (å«è¶Ÿé–“èˆ‡çµ„é–“)
  const singleSwimSec = (lm * 60) + ls;
  const totalSwimSec = singleSwimSec * laps * sets;
  const totalRestSec = rs * (sets - 1);
  
  items.push({
    name,
    detail: `${sets}çµ„ x (${laps}è¶Ÿ x ${dist}m)`,
    pace: `${lm}'${ls.toString().padStart(2, '0')}`,
    rest: rs,
    totalSec: totalSwimSec + totalRestSec,
    totalDist: dist * laps * sets,
    id: Date.now()
  });
  
  // æ¸…ç©ºè¼¸å…¥ä¸¦æ­¸ä½ç„¦é»
  ["lapMin", "lapSec", "dist", "laps", "sets", "restSec"].forEach(id => document.getElementById(id).value = "");
  document.getElementById('courseName').value = "";
  setFocus('lapMin');
  renderHUD();
}

function renderHUD() {
  const budgetMin = parseInt(document.getElementById('classTime').value) || 0;
  const usedSec = items.reduce((sum, i) => sum + i.totalSec, 0);
  const totalD = items.reduce((sum, i) => sum + i.totalDist, 0);
  const remSec = (budgetMin * 60) - usedSec;

  const absSec = Math.abs(remSec);
  const m = Math.floor(absSec / 60);
  const s = absSec % 60;
  
  const el = document.getElementById('remText');
  el.innerText = `${remSec < 0 ? '-' : ''}${m}:${s.toString().padStart(2,'0')}`;
  el.className = 'main-rem-time' + (remSec < 0 ? ' warn' : '');
  document.getElementById('totalDist').innerText = totalD + 'm';

  const list = document.getElementById('listArea');
  list.innerHTML = items.map(item => `
    <div class="course-card" onclick="deleteItem(${item.id})">
      <div style="flex:1">
        <div style="font-weight:bold; font-size:16px; color:var(--neon-blue); margin-bottom:4px;">${item.name}</div>
        <div style="font-size:13px; color:#8b949e;">${item.detail}</div>
        <div style="font-size:12px; color:#555; margin-top:4px;">é…é€Ÿ: ${item.pace} | ä¼‘æ¯: ${item.rest}s</div>
      </div>
      <div style="text-align:right; display:flex; flex-direction:column; justify-content:center;">
        <div style="font-size:18px; font-weight:800;">${item.totalDist}m</div>
        <div style="font-size:12px; color:#555;">${Math.floor(item.totalSec/60)}'${item.totalSec%60}"</div>
      </div>
    </div>
  `).reverse().join('');
  
  localStorage.setItem('swim_v5_items', JSON.stringify(items));
}

function deleteItem(id) {
    if(confirm('ç¢ºå®šç§»é™¤æ­¤è¨“ç·´é …ç›®ï¼Ÿ')) {
        items = items.filter(i => i.id !== id);
        renderHUD();
    }
}

function exportToText() {
  if (items.length === 0) return;
  const today = new Date().toLocaleDateString();
  let text = `ğŸŠâ€â™‚ï¸ã€æ¸¸æ³³è¨“ç·´èª²è¡¨ã€‘${today}\n`;
  text += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
  items.forEach((item, idx) => {
    text += `${idx + 1}. ${item.name}\n`;
    text += `   å…§å®¹ï¼š${item.detail}\n`;
    text += `   é…é€Ÿï¼š${item.pace} | ä¼‘æ¯ï¼š${item.rest}s\n\n`;
  });
  text += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
  text += `ç¸½è·é›¢ï¼š${document.getElementById('totalDist').innerText}\n`;
  text += `ç¸½é è¨ˆè€—æ™‚ï¼š${Math.floor(items.reduce((s,i)=>s+i.totalSec,0)/60)} åˆ†é˜`;

  // å˜—è©¦ä½¿ç”¨ç¾ä»£å‰ªè²¼ç°¿ API
  navigator.clipboard.writeText(text).then(() => {
      alert('âœ… èª²è¡¨å·²æ ¼å¼åŒ–è¤‡è£½ï¼\nç¾åœ¨å¯ä»¥åˆ° LINE ç›´æ¥è²¼ä¸Šã€‚');
  });
}

// å•Ÿå‹•
window.onload = () => {
  setFocus('lapMin');
  renderHUD();
};
</script>
</body>
</html>

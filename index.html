<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>游泳規劃器 ULTIMATE</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; touch-action: manipulation; }

:root {
  --primary: #007aff;
  --success: #4cd964;
  --warn: #ff3b30;
  --panel-bg: #1c1c1e;
  --input-bg: #2c2c2e;
}

html, body {
  font-family: -apple-system, BlinkMacSystemFont, "PingFang TC", sans-serif;
  background: #000; height: 100dvh; overflow: hidden; color: white;
}

.app { display: flex; flex-direction: column; height: 100dvh; }

/* ===== Header ===== */
.fixed-header { flex-shrink: 0; background: #000; border-bottom: 1px solid #333; z-index:100; }
.header-hud { padding: calc(env(safe-area-inset-top,10px)+6px) 15px 10px; display:flex; justify-content:space-between; align-items:center; }
.time-overlay { position: relative; text-align:right; min-width:130px; }
.bg-number {
  position: absolute; right:0; bottom:-8px; font-size:50px; font-weight:900;
  color:#333; opacity:0.4; transform: scaleX(1.4); transform-origin:right;
}
.main-number {
  position: relative; z-index:2; font-size:28px; font-weight:900;
  color: var(--success); transform: scaleX(1.2); transform-origin:right;
}

/* ===== Input Section ===== */
.input-section { padding: 8px 12px 12px; background: var(--panel-bg); display:flex; flex-direction:column; gap:8px; }

.label-sm { font-size:10px; color:#888; font-weight:bold; margin-bottom:2px; display:block; letter-spacing:0.5px; }

.row { display:flex; gap:8px; align-items:flex-end; }

.input-box { background: var(--input-bg); border:2px solid transparent; border-radius:10px; padding:6px; flex:1; transition: all 0.2s cubic-bezier(0.4,0,0.2,1); }
.input-box.active { border-color: var(--primary); background:#3a3a3c; transform: translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.5); }

.val-group { display:flex; align-items:baseline; justify-content:center; }
.val-group input {
  width:100%; background:transparent; border:none; color:#fff;
  font-size:22px; font-weight:900; text-align:center; outline:none; transform:scaleX(1.1);
}
.unit { font-size:10px; color:#666; margin-left:2px; font-weight:bold; }

/* ===== Buttons ===== */
.rest-and-add { display:grid; grid-template-columns:1.2fr 0.8fr; gap:10px; align-items:stretch; }
.btn-add { background: var(--primary); color:white; border:none; border-radius:10px; font-size:15px; font-weight:900; box-shadow:0 4px 10px rgba(0,122,255,0.3); }
.btn-add:active { transform: scale(0.95); background:#0056b3; }
.btn-reset { background:transparent; color:var(--warn); border:1px solid var(--warn); padding:4px 12px; border-radius:6px; font-size:11px; font-weight:800; }

/* ===== List ===== */
.main-content { flex:1; overflow-y:auto; padding:15px; background:#000; -webkit-overflow-scrolling:touch; scroll-behavior:smooth; }
.course-item {
  background:#1c1c1e; padding:14px; border-radius:12px; margin-bottom:10px;
  display:flex; justify-content:space-between; align-items:center; border-left:5px solid var(--primary);
  animation: slideIn 0.3s ease-out;
}
@keyframes slideIn { from { opacity:0; transform:translateX(-10px); } to { opacity:1; transform:translateX(0); } }

.item-info b { font-size:15px; color:#fff; display:block; margin-bottom:2px; }
.item-info p { font-size:12px; color:#666; font-weight:500; }
.item-time { font-size:18px; font-weight:900; transform:scaleX(1.1); }

/* ===== Keyboard ===== */
.fixed-footer { flex-shrink:0; background:#000; }
.footer-ctrl { padding:6px 15px; display:flex; justify-content:space-between; align-items:center; }
.numpad { display:grid; grid-template-columns:repeat(3,1fr); gap:6px; padding:5px 10px calc(env(safe-area-inset-bottom,10px)+8px); }
.numpad button { border:none; background:#262626; font-size:26px; font-weight:bold; color:white; border-radius:12px; padding:14px 0; transition:background 0.1s, transform 0.1s; }
.numpad button:active { background:#444; transform:scale(0.92); }
.btn-util { color:#888 !important; font-size:18px !important; }

.warn { color: var(--warn) !important; text-shadow:0 0 10px rgba(255,59,48,0.4); }
.warn-bg { color: var(--warn) !important; opacity:0.2 !important; }
</style>
</head>
<body>
<div class="app">
  <header class="fixed-header">
    <div class="header-hud">
      <div>
        <span class="label-sm">課程總長 (分)</span>
        <div class="input-box" id="box-classTime" style="width:85px;">
           <div class="val-group"><input id="classTime" readonly placeholder="0"></div>
        </div>
      </div>
      <div class="time-overlay">
        <span class="label-sm">剩餘可用</span>
        <div id="bgTotal" class="bg-number">00</div>
        <div id="remainingText" class="main-number">0分00秒</div>
      </div>
    </div>
    <section class="input-section">
      <div class="row">
        <div style="flex:1.1;">
          <span class="label-sm">單趟時間</span>
          <div style="display:flex; gap:6px;">
            <div class="input-box" id="box-lapMin"><div class="val-group"><input id="lapMin" readonly placeholder="0" data-next="lapSec"><span class="unit">分</span></div></div>
            <div class="input-box" id="box-lapSec"><div class="val-group"><input id="lapSec" readonly placeholder="0" data-next="lapsPerSet"><span class="unit">秒</span></div></div>
          </div>
        </div>
        <div style="flex:1;">
          <span class="label-sm">訓練結構</span>
          <div style="display:flex; gap:6px;">
            <div class="input-box" id="box-lapsPerSet"><div class="val-group"><input id="lapsPerSet" readonly placeholder="0" data-next="sets"><span class="unit">趟</span></div></div>
            <div class="input-box" id="box-sets"><div class="val-group"><input id="sets" readonly placeholder="0" data-next="restMin"><span class="unit">組</span></div></div>
          </div>
        </div>
      </div>
      <div class="rest-and-add">
        <div>
          <span class="label-sm">組間休息</span>
          <div style="display:flex; gap:6px;">
            <div class="input-box" id="box-restMin"><div class="val-group"><input id="restMin" readonly placeholder="0" data-next="restSec"><span class="unit">分</span></div></div>
            <div class="input-box" id="box-restSec"><div class="val-group"><input id="restSec" readonly placeholder="0"><span class="unit">秒</span></div></div>
          </div>
        </div>
        <button class="btn-add" onclick="addItem()">加入項目 (+)</button>
      </div>
    </section>
  </header>

  <main id="scrollArea" class="main-content">
    <div id="listContainer"></div>
  </main>

  <footer class="fixed-footer">
    <div class="footer-ctrl">
      <span style="font-size:10px; color:#333;">LONG PRESS TO DELETE</span>
      <button class="btn-reset" onclick="clearAll()">重置所有數據</button>
    </div>
    <div class="numpad">
      <button onclick="num(7)">7</button><button onclick="num(8)">8</button><button onclick="num(9)">9</button>
      <button onclick="num(4)">4</button><button onclick="num(5)">5</button><button onclick="num(6)">6</button>
      <button onclick="num(1)">1</button><button onclick="num(2)">2</button><button onclick="num(3)">3</button>
      <button class="btn-util" onclick="clearInput()">AC</button>
      <button onclick="num(0)">0</button>
      <button class="btn-util" style="color:var(--warn)!important;" onclick="back()">⌫</button>
    </div>
  </footer>
</div>

<script>
let activeInput = document.getElementById("classTime");
let items = [];
let pressTimer = null;

const vibrate = ms => { if(navigator.vibrate) navigator.vibrate(ms); };
const formatTimeCH = s => { const isNeg=s<0; const abs=Math.abs(s); return (isNeg?"-":"")+Math.floor(abs/60)+"分"+(abs%60).toString().padStart(2,'0')+"秒"; };

function updateFocusUI(el) { document.querySelectorAll('.input-box').forEach(b=>b.classList.remove('active')); let p=el.closest('.input-box'); if(p)p.classList.add('active'); }
document.querySelectorAll("input").forEach(input=>input.addEventListener("click",e=>{activeInput=input;updateFocusUI(activeInput);e.stopPropagation();}));

function num(n){if(!activeInput)return;if(activeInput.value.length>=4)return;activeInput.value+=n;vibrate(12);render();
if(activeInput.id!=="classTime"&&activeInput.value.length===2){if(activeInput.dataset.next){const next=document.getElementById(activeInput.dataset.next);if(next&&next.value===""){setTimeout(()=>{activeInput=next;updateFocusUI(next);},100);}}}}

function back(){if(activeInput){activeInput.value=activeInput.value.slice(0,-1);render();}}
function clearInput(){if(activeInput){activeInput.value='';render();}}

function addItem(){
  const getVal=id=>+document.getElementById(id).value||0;
  const lm=getVal("lapMin"),ls=getVal("lapSec"),lps=getVal("lapsPerSet"),st=getVal("sets"),rm=getVal("restMin"),rs=getVal("restSec");
  if(st<=0||lps<=0){vibrate([50,100]);alert("請輸入趟數與組數");return;}
  const total=((lm*60+ls)*lps*st)+((rm*60+rs)*(st>1?st-1:0));
  items.push({id:Date.now(),desc:`${lps}趟 x ${st}組`,seconds:total});
  vibrate(30);
  ["lapMin","lapSec","lapsPerSet","sets","restMin","restSec"].forEach(id=>document.getElementById(id).value="");
  const first=document.getElementById("lapMin");activeInput=first;updateFocusUI(first);
  render();document.getElementById("scrollArea").scrollTo({top:document.getElementById("scrollArea").scrollHeight,behavior:'smooth'});
}

function render(){
  const classVal=+document.getElementById("classTime").value||0;
  document.getElementById("bgTotal").innerText=classVal;
  const used=items.reduce((s,it)=>s+it.seconds,0);
  const remaining=(classVal*60)-used;
  const rText=document.getElementById("remainingText");
  rText.innerText=formatTimeCH(remaining);
  rText.classList.toggle("warn",remaining<0);
  const container=document.getElementById("listContainer");
  container.innerHTML="";
  items.forEach((item,index)=>{
    const div=document.createElement("div");
    div.className="course-item";
    div.innerHTML=`<div class="item-info"><b>項目 #${index+1}</b><p>${item.desc}</p></div><div class="item-time">${formatTimeCH(item.seconds)}</div>`;
    const start=()=>pressTimer=setTimeout(()=>{vibrate(60);if(confirm("確定刪除此項？")){items.splice(index,1);render();}},700);
    div.addEventListener("touchstart",start);div.addEventListener("touchend",()=>clearTimeout(pressTimer));
    container.appendChild(div);
  });
}

function clearAll(){if(confirm("確定重置所有數據？")){items=[];document.getElementById("classTime").value="";render();vibrate(100);}}

updateFocusUI(activeInput);
render();
</script>
</body>
</html>

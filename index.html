<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>æ¸¸æ³³æ•™ç·´æ——è‰¦å·¥ä½œå° v1.4.3</title>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<style>
:root{--bg-dark:#0d1117;--neon-blue:#00a2ff;--neon-green:#4cd964;--neon-red:#ff3b30;--z1:#4ae3ff;--z2:#4cda64;--z3:#ffcc00;--z4:#ff9500;--z56:#ff3b30;--cat-bg:#30363d;}
*{box-sizing:border-box;margin:0;padding:0;touch-action:manipulation;}
body{font-family:-apple-system,"PingFang TC",sans-serif;background:var(--bg-dark);color:#fff;height:100dvh;display:flex;flex-direction:column;overflow:hidden;padding-top:env(safe-area-inset-top,20px);}
.app-header{display:flex;background:#05070a;border-bottom:2px solid #1a2028;flex-shrink:0;}
.tab-btn{flex:1;padding:12px 0;text-align:center;font-size:13px;font-weight:900;color:#666;border-bottom:3px solid transparent;transition:0.2s;white-space:nowrap;}
.tab-btn.active{color:var(--neon-blue);border-bottom-color:var(--neon-blue);background:rgba(0,162,255,0.05);}
.content-wrapper{flex:1;position:relative;overflow:hidden;}
.page{position:absolute;top:0;left:0;width:100%;height:100%;display:none;flex-direction:column;}
.page.active{display:flex;}
iframe{width:100%;height:100%;border:none;background:#fff;}
/* HUDã€èª²ç¨‹è¦åŠƒã€åˆ—è¡¨ã€éµç›¤ã€è¨ˆæ™‚é˜æ¨£å¼åŒå‰ V1.4... */
</style>
</head>
<body>
<header class="app-header">
    <div id="tab-planner" class="tab-btn active" onclick="switchTab('planner')">ğŸ“ èª²ç¨‹è¦åŠƒ</div>
    <div id="tab-timer" class="tab-btn" onclick="switchTab('timer')">â±ï¸ è¨“ç·´è¨ˆæ™‚é˜</div>
    <div id="tab-percentage" class="tab-btn" onclick="switchTab('percentage')">â±ï¸ é€Ÿåº¦ç™¾åˆ†æ¯”</div>
    <div id="tab-segment" class="tab-btn" onclick="switchTab('segment')">ğŸ“Š åˆ†æ®µç´€éŒ„è¡¨</div>
</header>
<main class="content-wrapper">
  <!-- èª²ç¨‹è¦åŠƒ V1.4 HTML å…§å®¹ -->
  <div id="page-planner" class="page active">
    <!-- HUDã€èª²ç¨‹è¼¸å…¥ã€åˆ—è¡¨ã€éµç›¤... (ä¿ç•™ V1.4) -->
  </div>

  <!-- è¨“ç·´è¨ˆæ™‚é˜ -->
  <div id="page-timer" class="page">
    <div class="timer-controls">
      <h2>è¨“ç·´è¨ˆæ™‚é˜</h2>
      <div id="timerDisplay">00:00</div>
      <div class="btn-group">
          <button onclick="startTimer()" class="btn-slim">å•Ÿå‹•</button>
          <button onclick="pauseTimer()" class="btn-slim">æš«åœ</button>
          <button onclick="resetTimer()" class="btn-slim">é‡ç½®</button>
          <button onclick="endTimer()" class="btn-slim">çµæŸ</button>
      </div>
    </div>
  </div>

  <!-- é€Ÿåº¦ç™¾åˆ†æ¯” -->
  <div id="page-percentage" class="page"><iframe src="https://jason307325.github.io/percentage-time/"></iframe></div>

  <!-- åˆ†æ®µç´€éŒ„è¡¨ -->
  <div id="page-segment" class="page"><iframe src="ä½ çš„åˆ†æ®µç´€éŒ„ç¶²å€"></iframe></div>
</main>

<script>
// TAB åˆ‡æ›
function switchTab(tabName){
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('tab-'+tabName).classList.add('active');
  document.getElementById('page-'+tabName).classList.add('active');
}

// èª²ç¨‹èˆ‡è¨ˆæ™‚å™¨è¯å‹•
let items=[],currentItemIndex=0,elapsedTime=0,currentLaps=0,timerInterval,isRunning=false,totalElapsedDistance=0;

// è¨ˆæ™‚å™¨
function startTimer(){
  if(!isRunning && currentItemIndex<items.length){
    isRunning=true;
    const currentItem=items[currentItemIndex];
    if(currentLaps===0) currentLaps=currentItem.laps;
    timerInterval=setInterval(()=>{
      if(elapsedTime<currentItem.seconds){
        elapsedTime++;
        updateTimerDisplay();
        updateHUD(); // å¯¦æ™‚æ›´æ–° HUD
      }else{
        clearInterval(timerInterval);
        if(currentLaps>1){
          currentLaps--;
          elapsedTime=0;
          setTimeout(startTimer,3000);
        }else{
          totalElapsedDistance+=currentItem.dist;
          currentItemIndex++;
          elapsedTime=0;
          if(currentItemIndex<items.length){
            setTimeout(startTimer,3000);
          }else{
            isRunning=false;
            updateHUD();
          }
        }
      }
    },1000);
  }
}

function pauseTimer(){clearInterval(timerInterval);isRunning=false;}
function resetTimer(){clearInterval(timerInterval);elapsedTime=0;isRunning=false;currentItemIndex=0;currentLaps=0;totalElapsedDistance=0;updateTimerDisplay();updateHUD();}
function endTimer(){clearInterval(timerInterval);isRunning=false;elapsedTime=0;updateTimerDisplay();updateHUD();}

function updateTimerDisplay(){
  if(currentItemIndex<items.length){
    const currentItem=items[currentItemIndex];
    const remainingSeconds=currentItem.seconds-elapsedTime;
    const m=String(Math.floor(remainingSeconds/60)).padStart(2,'0');
    const s=String(remainingSeconds%60).padStart(2,'0');
    document.getElementById('timerDisplay').innerText=`${m}:${s}`;
  }else{
    document.getElementById('timerDisplay').innerText="00:00";
  }
}

// HUD æ›´æ–°
function updateHUD(){
  const remEl=document.getElementById('remText');
  const totalEl=document.getElementById('totalDist');
  let remaining=0;
  if(currentItemIndex<items.length){
    const cur=items[currentItemIndex];
    remaining=(cur.seconds-elapsedTime)+(currentLaps-1)*(cur.seconds); // å‰©é¤˜æ™‚é–“
  }
  remEl.innerText=`${Math.floor(remaining/60)}åˆ†${String(remaining%60).padStart(2,'0')}ç§’`;
  totalEl.innerText=`${totalElapsedDistance}m${currentItemIndex<items.length?'+'+(elapsedTime/elapsedTime*0):''}`; // å¯ä»¥æ“´å±•ç´¯è¨ˆè·é›¢
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>æ¸¸æ³³æ•™ç·´æ——è‰¦å·¥ä½œå° v1.5</title>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<style>
:root { --bg-dark:#0d1117; --neon-blue:#00a2ff; --neon-green:#4cd964; --neon-red:#ff3b30; }
body { font-family: -apple-system, "PingFang TC", sans-serif; background: var(--bg-dark); color:#fff; margin:0; height:100dvh; display:flex; flex-direction:column; overflow:hidden; padding-top:env(safe-area-inset-top,20px);}
.app-header { display:flex; background:#05070a; border-bottom:2px solid #1a2028; flex-shrink:0; }
.tab-btn { flex:1; padding:12px 0; text-align:center; font-size:13px; font-weight:900; color:#666; border-bottom:3px solid transparent; transition:.2s; white-space:nowrap; cursor:pointer;}
.tab-btn.active { color: var(--neon-blue); border-bottom-color: var(--neon-blue); background: rgba(0,162,255,0.05);}
.content-wrapper { flex:1; position:relative; overflow:hidden; }
.page { position:absolute; top:0; left:0; width:100%; height:100%; display:none; flex-direction:column; }
.page.active { display:flex; }
iframe { width:100%; height:100%; border:none; background:#fff; }

/* èª²ç¨‹è¦åŠƒæ¨£å¼ */
.hud-container { padding:10px 15px; background:#05070a; border-bottom:1px solid #1a2028; flex-shrink:0; }
.hud-inputs { display:flex; justify-content:space-between; align-items:center; gap:8px; }
.hud-item { flex:1; text-align:center; }
.label-sm { font-size:10px; color:#555; font-weight:900; margin-bottom:2px; display:block;}
#remText { font-size:18px; font-weight:900; color:var(--neon-green);}
#totalDist { font-size:18px; font-weight:900; color:var(--neon-blue);}
.glass-box { background:#090c10; border-radius:6px; border:1.5px solid #1a2028; display:flex; align-items:center; height:34px; width:100%; padding:0 5px; }
.glass-box input { width:100%; background:transparent; border:none; color:#fff; font-size:15px; font-weight:800; text-align:right; pointer-events:none;}
.panel { margin:6px 12px; padding:8px; border-radius:12px; background:#161b22; border:1px solid #30363d; flex-shrink:0; }
.row { display:flex; gap:4px; margin-bottom:4px; }
.text-input-box { width:100%; height:32px; background:rgba(0,0,0,0.5); border:1px solid #333; border-radius:6px; color:#fff; padding:0 10px; font-size:13px; }
.btn-slim { width:100%; height:36px; background: var(--neon-blue); border:none; border-radius:18px; color:#fff; font-weight:900; font-size:13px; cursor:pointer;}
.list-area { flex:1; overflow-y:auto; padding:5px 12px; }
.course-card { background: rgba(255,255,255,0.03); border-radius:8px; padding:8px 10px; margin-bottom:5px; display:flex; align-items:center; border:1px solid #222; gap:8px;}
.drag-handle { color:#333; font-size:14px; padding-right:5px; cursor:grab;}
.card-main-info { flex:1; min-width:0;}
.card-top-row { display:flex; align-items:baseline; gap:5px; margin-bottom:2px;}
.card-title { font-size:13px; font-weight:700; color:#eee; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.card-detail-row { font-size:10px; color:#888; display:flex; gap:3px; white-space:nowrap; overflow:hidden;}
.card-dist-side { font-size:12px; font-weight:900; color:var(--neon-blue); flex-shrink:0; }

/* è¨“ç·´è¨ˆæ™‚é˜æ¨£å¼ */
.timer-controls { padding:10px 15px; background:#05070a; border-bottom:1px solid #1a2028; flex-shrink:0; text-align:center;}
#timerDisplay { font-size:36px; font-weight:bold; color:var(--neon-green); margin:15px 0; }
.btn-group { display:flex; justify-content:space-around; gap:5px; }
.btn-group .btn-slim { flex:1; }

/* æ•´é«” iframe */
iframe { flex:1; }
</style>
</head>
<body>

<header class="app-header">
  <div id="tab-planner" class="tab-btn active" onclick="switchTab('planner')">ğŸ“ èª²ç¨‹è¦åŠƒ</div>
  <div id="tab-timer" class="tab-btn" onclick="switchTab('timer')">â±ï¸ è¨“ç·´è¨ˆæ™‚é˜</div>
  <div id="tab-percentage" class="tab-btn" onclick="switchTab('percentage')">ğŸ“Š é€Ÿåº¦ç™¾åˆ†æ¯”</div>
  <div id="tab-record" class="tab-btn" onclick="switchTab('record')">ğŸ“‹ åˆ†æ®µç´€éŒ„</div>
</header>

<main class="content-wrapper">

<!-- èª²ç¨‹è¦åŠƒ -->
<div id="page-planner" class="page active">
  <div class="hud-container">
    <div class="hud-inputs">
      <div class="hud-item"><span class="label-sm">ç´¯è¨ˆè·é›¢</span><div id="totalDist">0m</div></div>
      <div class="hud-item"><span class="label-sm">å‰©é¤˜æ™‚é–“</span><div id="remText">00:00</div></div>
    </div>
  </div>

  <div class="panel">
    <input type="text" id="courseNote" class="text-input-box" placeholder="é …ç›®å…§å®¹...">
    <div class="row">
      <input type="number" id="dist" class="text-input-box" placeholder="è·é›¢(m)" min="0">
      <input type="number" id="lapMin" class="text-input-box" placeholder="åˆ†" min="0">
      <input type="number" id="lapSec" class="text-input-box" placeholder="ç§’" min="0">
      <input type="number" id="laps" class="text-input-box" placeholder="è¶Ÿ" min="1">
      <input type="number" id="resMin" class="text-input-box" placeholder="ä¼‘åˆ†" min="0">
      <input type="number" id="resSec" class="text-input-box" placeholder="ä¼‘ç§’" min="0">
    </div>
    <button onclick="addItem()" class="btn-slim">åŠ å…¥è¨“ç·´é …ç›® (+)</button>
  </div>

  <div class="list-area" id="listArea"></div>
</div>

<!-- è¨“ç·´è¨ˆæ™‚é˜ -->
<div id="page-timer" class="page">
  <div class="timer-controls">
    <h2>è¨“ç·´è¨ˆæ™‚é˜</h2>
    <div id="timerDisplay">00:00</div>
    <div class="btn-group">
      <button onclick="startTimer()" class="btn-slim">å•Ÿå‹•</button>
      <button onclick="pauseTimer()" class="btn-slim">æš«åœ</button>
      <button onclick="resetTimer()" class="btn-slim">é‡ç½®</button>
      <button onclick="endTimer()" class="btn-slim">çµæŸ</button>
    </div>
  </div>
</div>

<!-- é€Ÿåº¦ç™¾åˆ†æ¯” -->
<div id="page-percentage" class="page">
  <iframe src="https://jason307325.github.io/percentage-time/"></iframe>
</div>

<!-- åˆ†æ®µç´€éŒ„ -->
<div id="page-record" class="page">
  <iframe src="https://ä½ çš„åˆ†æ®µç´€éŒ„è¡¨ç¶²å€/"></iframe>
</div>

</main>

<script>
// --- åˆ†é åˆ‡æ› ---
function switchTab(tabName){
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('tab-' + tabName).classList.add('active');
  document.getElementById('page-' + tabName).classList.add('active');
}

// --- èª²ç¨‹è¦åŠƒ ---
let items = [];
function addItem(){
  const note = document.getElementById('courseNote').value;
  const dist = parseInt(document.getElementById('dist').value)||0;
  const min = parseInt(document.getElementById('lapMin').value)||0;
  const sec = parseInt(document.getElementById('lapSec').value)||0;
  const laps = parseInt(document.getElementById('laps').value)||1;
  const resMin = parseInt(document.getElementById('resMin').value)||0;
  const resSec = parseInt(document.getElementById('resSec').value)||0;
  if(!note) return alert("è«‹è¼¸å…¥é …ç›®åç¨±");
  items.push({note,dist,min,sec,laps,resMin,resSec});
  renderList();
}
function renderList(){
  const list = document.getElementById('listArea'); list.innerHTML='';
  let totalDist=0, totalTime=0;
  items.forEach((item,i)=>{
    totalDist += item.dist*item.laps;
    totalTime += ((item.min*60+item.sec+item.resMin*60+item.resSec)*item.laps);
    const div = document.createElement('div'); div.className='course-card';
    div.innerHTML=`<span class="drag-handle">â˜°</span>
      <div class="card-main-info">
      <div class="card-top-row"><span class="card-title">${item.note}</span></div>
      <div class="card-detail-row">è·é›¢:${item.dist}m x${item.laps} è¶Ÿ / æ™‚é–“:${item.min}åˆ†${item.sec}ç§’</div>
      </div>`;
    list.appendChild(div);
  });
  document.getElementById('totalDist').innerText=totalDist+'m';
  document.getElementById('remText').innerText = `${Math.floor(totalTime/60)}åˆ† ${totalTime%60}ç§’`;
  Sortable.create(list,{handle:'.drag-handle'});
}

// --- è¨“ç·´è¨ˆæ™‚é˜ ---
let timerInterval=null, elapsedTime=0, currentIndex=0, lap=0;
function startTimer(){
  if(items.length===0) return alert("è«‹å…ˆæ–°å¢èª²ç¨‹é …ç›®");
  if(!timerInterval){
    timerInterval=setInterval(timerTick,1000);
  }
}
function pauseTimer(){ clearInterval(timerInterval); timerInterval=null; }
function resetTimer(){ clearInterval(timerInterval); timerInterval=null; elapsedTime=0; currentIndex=0; lap=0; updateTimerDisplay(); }
function endTimer(){ clearInterval(timerInterval); timerInterval=null; elapsedTime=0; updateTimerDisplay(); alert("è¨“ç·´çµæŸ"); }
function timerTick(){
  if(currentIndex>=items.length){ clearInterval(timerInterval); timerInterval=null; return; }
  let item=items[currentIndex];
  let totalSec=item.min*60+item.sec;
  if(lap<item.laps){ elapsedTime++; updateTimerDisplay(totalSec); lap++; }
  else{ currentIndex++; lap=0; }
}
function updateTimerDisplay(totalSec=0){
  let displaySec=totalSec-elapsedTime;
  if(displaySec<0) displaySec=0;
  let m=Math.floor(displaySec/60), s=displaySec%60;
  document.getElementById('timerDisplay').innerText=`${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}

// --- é˜²ä¼‘çœ  ---
if('wakeLock' in navigator){ let wakeLock=null; async function requestWakeLock(){ try{wakeLock=await navigator.wakeLock.request('screen');} catch(e){console.log(e);} } requestWakeLock(); }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æ¸¸æ³³èª²ç¨‹æ™‚é–“è¦åŠƒå™¨ - å°ˆæ¥­ç´”æ·¨ç‰ˆ</title>
<style>
/* é—œéµä¿®æ­£ 2: å…¨åŸŸåœç”¨é›™é»ç¸®æ”¾ï¼Œå„ªåŒ–é»æ“Šåæ‡‰é€Ÿåº¦ */
* { 
  box-sizing: border-box; 
  margin: 0; 
  padding: 0; 
  touch-action: manipulation; 
}

html, body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: #eaf6ff;
  height: 100%;
  overflow: hidden;
  /* ç¦æ­¢ä½¿ç”¨è€…é¸å–æ–‡å­—ï¼Œé¿å…é•·æŒ‰å½ˆå‡ºç³»çµ±é¸å–® */
  -webkit-user-select: none;
  user-select: none;
}

.app { display: flex; flex-direction: column; height: 100vh; }

.main {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  padding-bottom: 35vh; /* ç¢ºä¿å…§å®¹ä¸è¢« 1/3 éµç›¤é®æ“‹ */
}

.container { max-width: 480px; margin: auto; }

h1 { text-align: center; font-size: 20px; color: #0b5394; margin-bottom: 16px; }

.section { margin-bottom: 12px; }
.label { font-weight: 600; font-size: 14px; margin-bottom: 4px; display: block; color: #444; }

.input-card { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }

/* é—œéµä¿®æ­£ 3: Input æ¨£å¼å„ªåŒ– */
input {
  width: 100%;
  padding: 14px;
  font-size: 20px;
  border-radius: 10px;
  border: 2px solid #bbb;
  text-align: center;
  background: #fff;
  transition: all 0.2s;
  /* ç¢ºä¿å®Œå…¨ä¸æœƒé–ƒçˆæ¸¸æ¨™ */
  caret-color: transparent;
}

/* ç•¶å‰é¸ä¸­çš„è¼¸å…¥æ¡†æ¨£å¼ */
input.active-focus {
  outline: none;
  border-color: #1abc9c;
  background: #f0fffd;
  box-shadow: 0 0 8px rgba(26,188,156,0.2);
}

.btn-group { display: flex; gap: 8px; margin-top: 10px; }
button.action {
  flex: 1;
  padding: 14px;
  font-size: 16px;
  border: none;
  border-radius: 10px;
  color: #fff;
  font-weight: bold;
}
.btn-add { background: linear-gradient(145deg, #1abc9c, #16a085); }
.btn-clear { background: #95a5a6; }

.summary {
  padding: 12px;
  border-radius: 12px;
  font-weight: bold;
  margin: 15px 0;
  text-align: center;
}
.ok { background: #d1f2eb; color: #16a085; }
.over { background: #fadbd8; color: #c0392b; }

.item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  margin-bottom: 8px;
  border-radius: 10px;
  background: #fff;
  border-left: 5px solid #3498db;
}
.delete { color: #e74c3c; font-weight: bold; padding: 5px; }

/* è™›æ“¬éµç›¤ - ä½”æ“šè¢å¹• 1/3 */
.numpad {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  height: 33.33vh;
  background: #d4e6f1;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(4, 1fr);
  gap: 4px;
  padding: 6px;
  z-index: 1000;
}

.numpad button {
  border: none;
  border-radius: 8px;
  font-size: 24px;
  font-weight: bold;
  background: #fff;
  color: #2c3e50;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 0 #bdc3c7;
}

.numpad button:active {
  background: #ebf5fb;
  transform: translateY(2px);
  box-shadow: none;
}

.btn-util { color: #e67e22 !important; }
.btn-del { color: #c0392b !important; }
</style>
</head>
<body>

<div class="app">
  <div class="main">
    <div class="container">
      <h1>ğŸŠ æ¸¸æ³³èª²ç¨‹è¦åŠƒå™¨</h1>

      <div class="section">
        <span class="label">èª²å ‚ç¸½æ™‚é–“ï¼ˆåˆ†é˜ï¼‰</span>
        <input id="classTime" readonly placeholder="é»æ“Šè¼¸å…¥">
      </div>

      <div class="section">
        <span class="label">å–®è¶Ÿæ™‚é–“</span>
        <div class="input-card">
          <input id="lapMin" readonly placeholder="åˆ†">
          <input id="lapSec" readonly placeholder="ç§’">
        </div>
      </div>

      <div class="section">
        <span class="label">çµæ§‹ï¼šè¶Ÿæ•¸ / çµ„æ•¸</span>
        <div class="input-card">
          <input id="lapsPerSet" readonly placeholder="è¶Ÿæ•¸">
          <input id="sets" readonly placeholder="çµ„æ•¸">
        </div>
      </div>

      <div class="section">
        <span class="label">çµ„é–“ä¼‘æ¯</span>
        <div class="input-card">
          <input id="restMin" readonly placeholder="åˆ†">
          <input id="restSec" readonly placeholder="ç§’">
        </div>
      </div>

      <div class="btn-group">
        <button class="action btn-add" onclick="addItem()">â• åŠ å…¥èª²ç¨‹</button>
        <button class="action btn-clear" onclick="clearAll()">ğŸ—‘ é‡ç½®</button>
      </div>

      <div id="summary" class="summary ok">è«‹è¨­å®šæ™‚é–“</div>
      <div id="list" class="list"></div>
    </div>
  </div>

  <div class="numpad">
    <button onclick="num(7)">7</button>
    <button onclick="num(8)">8</button>
    <button onclick="num(9)">9</button>
    <button onclick="num(4)">4</button>
    <button onclick="num(5)">5</button>
    <button onclick="num(6)">6</button>
    <button onclick="num(1)">1</button>
    <button onclick="num(2)">2</button>
    <button onclick="num(3)">3</button>
    <button class="btn-util" onclick="clearInput()">AC</button>
    <button onclick="num(0)">0</button>
    <button class="btn-del" onclick="back()">âŒ«</button>
  </div>
</div>

<script>
let activeInput = null;
let items = [];

const formatTime = s => {
  const m = Math.floor(Math.abs(s) / 60);
  const sec = Math.abs(s) % 60;
  return `${m}åˆ†${sec}ç§’`;
};

// ä¿®æ­£ 4: æ”¹ç”¨ readonly + è‡ªå®šç¾©é»æ“Šäº‹ä»¶ï¼Œå¾¹åº•å°é–åŸç”Ÿéµç›¤
document.querySelectorAll("input").forEach(input => {
  input.addEventListener("click", function() {
    // ç§»é™¤å…¶ä»–æ‰€æœ‰è¼¸å…¥æ¡†çš„é«˜äº®
    document.querySelectorAll("input").forEach(el => el.classList.remove("active-focus"));
    // é«˜äº®ç•¶å‰
    this.classList.add("active-focus");
    activeInput = this;
  });
});

function num(n) { 
  if(activeInput) {
    activeInput.value += n; 
    render();
  }
}

function back() { 
  if(activeInput) {
    activeInput.value = activeInput.value.slice(0,-1); 
    render();
  }
}

function clearInput() { 
  if(activeInput) {
    activeInput.value = ''; 
    render();
  }
}

function addItem() {
  const lapTime = (+document.getElementById("lapMin").value || 0) * 60 + (+document.getElementById("lapSec").value || 0);
  const laps = (+document.getElementById("lapsPerSet").value || 0);
  const setsNum = (+document.getElementById("sets").value || 0);
  const restTime = ((+document.getElementById("restMin").value || 0) * 60 + (+document.getElementById("restSec").value || 0)) * Math.max(setsNum - 1, 0);
  
  const total = (lapTime * laps * setsNum) + restTime;
  
  if(total <= 0) return alert("è«‹è¼¸å…¥æœ‰æ•ˆå…§å®¹");

  items.push({ desc: `${laps}è¶Ÿ x ${setsNum}çµ„`, seconds: total });
  
  // æ¸…é™¤é™¤äº†ç¸½æ™‚é–“å¤–çš„æ¬„ä½
  ["lapMin", "lapSec", "lapsPerSet", "sets", "restMin", "restSec"].forEach(id => {
    document.getElementById(id).value = "";
  });
  render();
}

function render() {
  const totalLimit = (+document.getElementById("classTime").value || 0) * 60;
  const usedSeconds = items.reduce((sum, item) => sum + item.seconds, 0);
  const remaining = totalLimit - usedSeconds;

  const listEl = document.getElementById("list");
  listEl.innerHTML = "";
  
  items.forEach((item, i) => {
    const d = document.createElement("div");
    d.className = "item";
    d.innerHTML = `
      <div><strong>#${i+1}</strong> ${item.desc}</div>
      <div>${formatTime(item.seconds)} <span class="delete" onclick="del(${i})">âœ•</span></div>
    `;
    listEl.appendChild(d);
  });

  const summaryEl = document.getElementById("summary");
  if(totalLimit === 0) {
    summaryEl.className = "summary ok";
    summaryEl.innerHTML = "è«‹å…ˆè¨­å®šèª²å ‚ç¸½æ™‚é–“";
  } else {
    summaryEl.className = "summary " + (remaining >= 0 ? "ok" : "over");
    summaryEl.innerHTML = (remaining >= 0 ? "â³ å‰©é¤˜ï¼š" : "âš ï¸ è¶…å‡ºï¼š") + formatTime(remaining);
  }
}

function del(i) {
  items.splice(i, 1);
  render();
}

function clearAll() {
  if(confirm("ç¢ºå®šé‡ç½®ï¼Ÿ")) {
    items = [];
    render();
  }
}
</script>

</body>
</html>
